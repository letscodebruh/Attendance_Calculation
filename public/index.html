<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Punch Tracker — Work & Break Analytics</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>⏱</text></svg>" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, Ubuntu, sans-serif;
      background: 
        radial-gradient(circle at 25% 25%, rgba(59, 130, 246, 0.12), transparent 50%),
        radial-gradient(circle at 75% 75%, rgba(16, 185, 129, 0.08), transparent 60%),
        radial-gradient(circle at 50% 10%, rgba(139, 92, 246, 0.06), transparent 40%),
        linear-gradient(135deg, #f8fafc 0%, #e2e8f0 30%, #f1f5f9 70%, #ffffff 100%);
      background-attachment: fixed;
      color: #1e293b;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      line-height: 1.6;
      overflow-x: hidden;
    }

    .container {
      width: 100%;
      max-width: 1200px;
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(40px) saturate(180%);
      -webkit-backdrop-filter: blur(40px) saturate(180%);
      border-radius: 32px;
      border: 1.5px solid rgba(255, 255, 255, 0.25);
      box-shadow: 
        0 32px 64px -12px rgba(15, 23, 42, 0.12),
        0 0 0 1px rgba(255, 255, 255, 0.05),
        inset 0 1px 0 rgba(255, 255, 255, 0.30),
        inset 0 -1px 0 rgba(255, 255, 255, 0.10);
      padding: 48px;
      position: relative;
      overflow: hidden;
    }

    .container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(circle at 20% 20%, rgba(59, 130, 246, 0.03), transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(16, 185, 129, 0.02), transparent 50%),
        radial-gradient(circle at 60% 40%, rgba(139, 92, 246, 0.02), transparent 40%);
      border-radius: 32px;
      z-index: -1;
    }

    .container::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.10) 0%, 
        rgba(255, 255, 255, 0.05) 25%, 
        rgba(255, 255, 255, 0.02) 50%, 
        rgba(255, 255, 255, 0.06) 100%);
      border-radius: 32px;
      z-index: -1;
    }

    h1 {
      font-size: clamp(28px, 4vw, 42px);
      font-weight: 800;
      text-align: center;
      color: #94a3b8;
      margin-bottom: 32px;
      letter-spacing: -1.5px;
      position: relative;
    }

    .clock-container {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      margin-bottom: 40px;
      flex-wrap: wrap;
    }

    .clock {
      font-size: 20px;
      font-weight: 600;
      text-align: center;
      color: #64748b;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(30px) saturate(180%);
      -webkit-backdrop-filter: blur(30px) saturate(180%);
      padding: 24px 36px;
      border-radius: 24px;
      border: 1.5px solid rgba(255, 255, 255, 0.30);
      box-shadow: 
        0 16px 40px rgba(15, 23, 42, 0.06),
        0 0 0 1px rgba(255, 255, 255, 0.08),
        inset 0 2px 0 rgba(255, 255, 255, 0.40),
        inset 0 -2px 0 rgba(255, 255, 255, 0.10);
      display: inline-block;
      letter-spacing: 0.5px;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .clock::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, 
        transparent, 
        rgba(255, 255, 255, 0.20), 
        transparent);
      transition: left 1.2s ease-in-out;
    }

    .clock:hover::before {
      left: 100%;
    }

    .clock:hover {
      transform: translateY(-1px) scale(1.005);
      box-shadow: 
        0 20px 50px rgba(15, 23, 42, 0.08),
        0 0 0 1px rgba(255, 255, 255, 0.12),
        inset 0 2px 0 rgba(255, 255, 255, 0.50),
        inset 0 -2px 0 rgba(255, 255, 255, 0.15);
    }

    .nav-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 16px 24px;
      border-radius: 20px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      background: rgba(255, 255, 255, 0.12);
      backdrop-filter: blur(25px) saturate(150%);
      -webkit-backdrop-filter: blur(25px) saturate(150%);
      color: #64748b;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 
        0 8px 25px rgba(15, 23, 42, 0.06),
        0 0 0 1px rgba(255, 255, 255, 0.08),
        inset 0 1px 0 rgba(255, 255, 255, 0.25);
      position: relative;
      overflow: hidden;
      letter-spacing: 0.3px;
    }

    .nav-btn.active {
      background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      color: #ffffff;
      box-shadow: 
        0 12px 35px rgba(59, 130, 246, 0.20),
        0 6px 20px rgba(29, 78, 216, 0.12),
        inset 0 1px 0 rgba(255, 255, 255, 0.20);
    }

    .nav-btn:hover {
      transform: translateY(-1px) scale(1.02);
      background: rgba(255, 255, 255, 0.18);
    }

    .nav-btn.active:hover {
      background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
    }

    .view-section {
      display: none;
    }

    .view-section.active {
      display: block;
    }

    .card {
      background: rgba(255, 255, 255, 0.12);
      backdrop-filter: blur(35px) saturate(180%);
      -webkit-backdrop-filter: blur(35px) saturate(180%);
      border-radius: 24px;
      border: 1.5px solid rgba(255, 255, 255, 0.25);
      box-shadow: 
        0 20px 50px rgba(15, 23, 42, 0.06),
        0 8px 25px rgba(15, 23, 42, 0.03),
        0 0 0 1px rgba(255, 255, 255, 0.06),
        inset 0 2px 0 rgba(255, 255, 255, 0.35),
        inset 0 -1px 0 rgba(255, 255, 255, 0.10);
      padding: 32px;
      margin-bottom: 28px;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.08) 0%, 
        rgba(255, 255, 255, 0.04) 50%, 
        rgba(255, 255, 255, 0.10) 100%);
      border-radius: 24px;
      z-index: -1;
    }

    .card::after {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      height: 2px;
      background: linear-gradient(90deg, 
        transparent, 
        rgba(255, 255, 255, 0.3), 
        transparent);
      border-radius: 24px 24px 0 0;
      opacity: 0.5;
    }

    .card:hover {
      transform: translateY(-2px) scale(1.002);
      background: rgba(255, 255, 255, 0.16);
      box-shadow: 
        0 28px 70px rgba(15, 23, 42, 0.08),
        0 12px 35px rgba(15, 23, 42, 0.04),
        0 0 0 1px rgba(255, 255, 255, 0.10),
        inset 0 2px 0 rgba(255, 255, 255, 0.45),
        inset 0 -1px 0 rgba(255, 255, 255, 0.15);
    }

    .section-title {
      font-size: 14px;
      font-weight: 700;
      color: #475569;
      margin-bottom: 18px;
      text-transform: uppercase;
      letter-spacing: 1.2px;
      position: relative;
      padding-bottom: 10px;
    }

    .section-title::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 45px;
      height: 3px;
      background: linear-gradient(135deg, #3b82f6 0%, #06b6d4 100%);
      border-radius: 2px;
      box-shadow: 0 2px 6px rgba(59, 130, 246, 0.2);
    }

    .section-title-disclaimer {
      font-size: 10px;
      font-weight: 500;
      color: #64748b;
      text-transform: none;
      letter-spacing: 0.5px;
      margin-top: 2px;
      opacity: 0.8;
    }

    /* Working Days Setup Styling */
    .working-days-setup {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 24px;
      padding: 20px;
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(20px) saturate(140%);
      -webkit-backdrop-filter: blur(20px) saturate(140%);
      border-radius: 18px;
      border: 1px solid rgba(255, 255, 255, 0.20);
      box-shadow: 
        0 6px 20px rgba(15, 23, 42, 0.03),
        inset 0 1px 0 rgba(255, 255, 255, 0.25);
      flex-wrap: wrap;
      justify-content: center;
    }

    .days-input {
      width: 100px;
      padding: 12px 16px;
      border-radius: 12px;
      border: 2px solid rgba(255, 255, 255, 0.20);
      background: rgba(248, 250, 252, 0.06);
      backdrop-filter: blur(15px) saturate(120%);
      -webkit-backdrop-filter: blur(15px) saturate(120%);
      color: #334155;
      font-size: 16px;
      font-weight: 600;
      text-align: center;
      transition: all 0.2s ease;
    }

    .days-input:focus {
      outline: none;
      border-color: rgba(59, 130, 246, 0.4);
      background: rgba(255, 255, 255, 0.12);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.06);
    }

    .days-input.error {
      border-color: rgba(239, 68, 68, 0.4);
      background: rgba(254, 226, 226, 0.08);
    }

    .days-label {
      font-size: 14px;
      font-weight: 600;
      color: #475569;
    }

    .days-help {
      font-size: 12px;
      color: #64748b;
      font-weight: 500;
      opacity: 0.8;
      line-height: 1.4;
      flex-basis: 100%;
      text-align: center;
      margin-top: 8px;
    }

    /* Day Row Styling */
    .day-row {
      display: flex;
      align-items: center;
      margin-bottom: 16px;
      padding: 16px 20px;
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(20px) saturate(140%);
      -webkit-backdrop-filter: blur(20px) saturate(140%);
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.20);
      box-shadow: 
        0 6px 20px rgba(15, 23, 42, 0.03),
        inset 0 1px 0 rgba(255, 255, 255, 0.25);
      transition: all 0.2s ease;
      flex-wrap: wrap;
      gap: 12px;
    }

    .day-row:hover {
      background: rgba(255, 255, 255, 0.12);
      transform: translateY(-1px);
      box-shadow: 
        0 8px 25px rgba(15, 23, 42, 0.05),
        inset 0 1px 0 rgba(255, 255, 255, 0.30);
    }

    .day-row.current-day {
      background: rgba(16, 185, 129, 0.08);
      border-color: rgba(16, 185, 129, 0.30);
    }

    .day-label {
      font-weight: 700;
      width: 100px;
      color: #475569;
      font-size: 14px;
    }

    .current-day .day-label {
      color: #059669;
    }

    .time-inputs {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-right: 20px;
    }

    .time-input {
      width: 70px;
      padding: 8px 10px;
      border-radius: 8px;
      border: 2px solid rgba(255, 255, 255, 0.20);
      background: rgba(248, 250, 252, 0.06);
      backdrop-filter: blur(15px) saturate(120%);
      -webkit-backdrop-filter: blur(15px) saturate(120%);
      color: #334155;
      font-size: 14px;
      font-weight: 600;
      text-align: center;
      transition: all 0.2s ease;
    }

    .time-input:focus {
      outline: none;
      border-color: rgba(59, 130, 246, 0.4);
      background: rgba(255, 255, 255, 0.12);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.06);
    }

    .time-label {
      font-size: 12px;
      font-weight: 500;
      color: #64748b;
    }

    /* Custom Hours Input Styling */
    .custom-hours-input {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 24px;
      padding: 20px;
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(20px) saturate(140%);
      -webkit-backdrop-filter: blur(20px) saturate(140%);
      border-radius: 18px;
      border: 1px solid rgba(255, 255, 255, 0.20);
      box-shadow: 
        0 6px 20px rgba(15, 23, 42, 0.03),
        inset 0 1px 0 rgba(255, 255, 255, 0.25);
      flex-wrap: wrap;
    }

    .hours-input-group {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    textarea {
      width: 100%;
      min-height: 170px;
      padding: 24px;
      border-radius: 20px;
      border: 2px solid rgba(255, 255, 255, 0.20);
      font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
      font-size: 14px;
      resize: vertical;
      background: rgba(248, 250, 252, 0.06);
      backdrop-filter: blur(25px) saturate(150%);
      -webkit-backdrop-filter: blur(25px) saturate(150%);
      color: #334155;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 
        0 8px 32px rgba(15, 23, 42, 0.04),
        inset 0 2px 0 rgba(255, 255, 255, 0.25),
        inset 0 -1px 0 rgba(255, 255, 255, 0.08);
      line-height: 1.6;
    }

    textarea::placeholder {
      color: rgba(100, 116, 139, 0.7);
      font-style: italic;
    }

    textarea:focus {
      outline: none;
      border-color: rgba(59, 130, 246, 0.4);
      background: rgba(255, 255, 255, 0.12);
      transform: scale(1.001);
      box-shadow: 
        0 12px 40px rgba(59, 130, 246, 0.05),
        0 0 0 3px rgba(59, 130, 246, 0.06),
        inset 0 2px 0 rgba(255, 255, 255, 0.35),
        inset 0 -1px 0 rgba(255, 255, 255, 0.12);
    }

    .error-indication {
      display: none;
      padding: 12px 18px;
      margin-top: 12px;
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
      border-radius: 12px;
      font-size: 13px;
      font-weight: 600;
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 6px 20px rgba(239, 68, 68, 0.15);
      animation: slideInError 0.3s ease-out;
    }

    @keyframes slideInError {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 12px;
      padding: 18px 32px;
      border-radius: 18px;
      border: none;
      cursor: pointer;
      font-weight: 700;
      font-size: 15px;
      background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 50%, #1e40af 100%);
      color: #ffffff;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 
        0 12px 35px rgba(59, 130, 246, 0.20),
        0 6px 20px rgba(29, 78, 216, 0.12),
        inset 0 1px 0 rgba(255, 255, 255, 0.20);
      position: relative;
      overflow: hidden;
      letter-spacing: 0.5px;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    }

    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, 
        transparent, 
        rgba(255, 255, 255, 0.30), 
        transparent);
      transition: left 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .btn:hover::before {
      left: 100%;
    }

    .btn:hover {
      transform: translateY(-1px) scale(1.005);
      box-shadow: 
        0 16px 45px rgba(59, 130, 246, 0.25),
        0 8px 25px rgba(29, 78, 216, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.25);
    }

    .btn:active {
      transform: translateY(0) scale(1.002);
    }

    .btn:disabled {
      opacity: 0.7;
      cursor: not-allowed;
      transform: none;
      box-shadow: 
        0 8px 25px rgba(59, 130, 246, 0.12),
        inset 0 1px 0 rgba(255, 255, 255, 0.15);
    }

    .btn-clear {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 50%, #b91c1c 100%);
      box-shadow: 
        0 12px 35px rgba(239, 68, 68, 0.20),
        0 6px 20px rgba(220, 38, 38, 0.12),
        inset 0 1px 0 rgba(255, 255, 255, 0.20);
    }

    .btn-clear:hover {
      box-shadow: 
        0 16px 45px rgba(239, 68, 68, 0.25),
        0 8px 25px rgba(220, 38, 38, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.25);
    }

    .toggle-btn {
      background: rgba(100, 116, 139, 0.1);
      border: 1px solid rgba(100, 116, 139, 0.2);
      color: #64748b;
      padding: 12px 20px;
      font-size: 14px;
      font-weight: 600;
      margin-top: 16px;
      box-shadow: 
        0 6px 20px rgba(100, 116, 139, 0.08),
        inset 0 1px 0 rgba(255, 255, 255, 0.15);
    }

    .toggle-btn:hover {
      background: rgba(100, 116, 139, 0.15);
      border-color: rgba(100, 116, 139, 0.3);
      box-shadow: 
        0 8px 25px rgba(100, 116, 139, 0.12),
        inset 0 1px 0 rgba(255, 255, 255, 0.20);
    }

    .toggle-btn.active {
      background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      border-color: rgba(59, 130, 246, 0.3);
      color: #ffffff;
    }

    .checkbox-container {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-top: 20px;
      padding: 16px 20px;
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(20px) saturate(140%);
      -webkit-backdrop-filter: blur(20px) saturate(140%);
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.20);
      box-shadow: 
        0 6px 20px rgba(15, 23, 42, 0.03),
        inset 0 1px 0 rgba(255, 255, 255, 0.25);
      transition: all 0.2s ease;
    }

    .checkbox-container:hover {
      background: rgba(255, 255, 255, 0.12);
      transform: translateY(-1px);
      box-shadow: 
        0 8px 25px rgba(15, 23, 42, 0.05),
        inset 0 1px 0 rgba(255, 255, 255, 0.30);
    }

    .custom-checkbox {
      position: relative;
      width: 20px;
      height: 20px;
      cursor: pointer;
    }

    .custom-checkbox input[type="checkbox"] {
      width: 100%;
      height: 100%;
      opacity: 0;
      cursor: pointer;
      position: absolute;
      z-index: 2;
    }

    .checkmark {
      position: absolute;
      top: 0;
      left: 0;
      height: 20px;
      width: 20px;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 2px solid rgba(59, 130, 246, 0.30);
      border-radius: 6px;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .custom-checkbox input[type="checkbox"]:checked + .checkmark {
      background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      border-color: rgba(59, 130, 246, 0.60);
      box-shadow: 
        0 4px 15px rgba(59, 130, 246, 0.25),
        inset 0 1px 0 rgba(255, 255, 255, 0.20);
    }

    .checkmark::after {
      content: '';
      position: absolute;
      display: none;
      left: 5px;
      top: 2px;
      width: 4px;
      height: 8px;
      border: solid white;
      border-width: 0 2px 2px 0;
      transform: rotate(45deg);
    }

    .custom-checkbox input[type="checkbox"]:checked + .checkmark::after {
      display: block;
    }

    .checkbox-label {
      font-size: 14px;
      font-weight: 600;
      color: #475569;
      cursor: pointer;
      user-select: none;
      flex: 1;
    }

    .checkbox-help {
      font-size: 12px;
      color: #64748b;
      font-weight: 500;
      opacity: 0.8;
      margin-top: 4px;
      line-height: 1.4;
    }

    /* Radio Button Styling for Day Mode */
    .radio-container {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-top: 20px;
      padding: 16px 20px;
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(20px) saturate(140%);
      -webkit-backdrop-filter: blur(20px) saturate(140%);
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.20);
      box-shadow: 
        0 6px 20px rgba(15, 23, 42, 0.03),
        inset 0 1px 0 rgba(255, 255, 255, 0.25);
      transition: all 0.2s ease;
    }

    .radio-container:hover {
      background: rgba(255, 255, 255, 0.12);
      transform: translateY(-1px);
      box-shadow: 
        0 8px 25px rgba(15, 23, 42, 0.05),
        inset 0 1px 0 rgba(255, 255, 255, 0.30);
    }

    .radio-option {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
    }

    .custom-radio {
      position: relative;
      width: 20px;
      height: 20px;
      cursor: pointer;
    }

    .custom-radio input[type="radio"] {
      width: 100%;
      height: 100%;
      opacity: 0;
      cursor: pointer;
      position: absolute;
      z-index: 2;
    }

    .radio-checkmark {
      position: absolute;
      top: 0;
      left: 0;
      height: 20px;
      width: 20px;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 2px solid rgba(59, 130, 246, 0.30);
      border-radius: 50%;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .custom-radio input[type="radio"]:checked + .radio-checkmark {
      background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      border-color: rgba(59, 130, 246, 0.60);
      box-shadow: 
        0 4px 15px rgba(59, 130, 246, 0.25),
        inset 0 1px 0 rgba(255, 255, 255, 0.20);
    }

    .radio-checkmark::after {
      content: '';
      position: absolute;
      display: none;
      width: 8px;
      height: 8px;
      background: white;
      border-radius: 50%;
    }

    .custom-radio input[type="radio"]:checked + .radio-checkmark::after {
      display: block;
    }

    .radio-label {
      font-size: 14px;
      font-weight: 600;
      color: #475569;
      cursor: pointer;
      user-select: none;
    }

    /* Status Options for Day Rows - SIMPLIFIED */
    .status-options {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      flex: 1;
      min-width: 200px;
    }

    .status-option {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
    }

    .status-option input[type="radio"] {
      margin: 0;
      transform: scale(1.1);
    }

    .status-option label {
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
    }

    .full-day label { color: #059669; }
    .half-day label { color: #2563eb; }

    .meta {
      font-size: 13px;
      color: #64748b;
      font-weight: 500;
      opacity: 0.9;
      text-shadow: 0 1px 2px rgba(255, 255, 255, 0.5);
    }

    .meta-info {
      color: #0891b2 !important;
      font-weight: 600 !important;
      opacity: 1 !important;
    }

    .log {
      max-height: 260px;
      overflow-y: auto;
      overflow-x: hidden;
      padding: 20px;
      border-radius: 18px;
      background: rgba(248, 250, 252, 0.06);
      backdrop-filter: blur(20px) saturate(120%);
      -webkit-backdrop-filter: blur(20px) saturate(120%);
      border: 1.5px solid rgba(255, 255, 255, 0.15);
      font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
      font-size: 14px;
      margin-top: 24px;
      box-shadow: 
        inset 0 4px 20px rgba(15, 23, 42, 0.03),
        inset 0 1px 0 rgba(255, 255, 255, 0.20);
      display: none;
      animation: fadeInSlide 0.3s ease-out;
    }

    .log.visible {
      display: block;
    }

    .log::-webkit-scrollbar {
      width: 8px;
    }

    .log::-webkit-scrollbar-track {
      background: rgba(203, 213, 225, 0.12);
      border-radius: 4px;
    }

    .log::-webkit-scrollbar-thumb {
      background: rgba(59, 130, 246, 0.20);
      border-radius: 4px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: background 0.2s ease;
    }

    .log::-webkit-scrollbar-thumb:hover {
      background: rgba(59, 130, 246, 0.35);
    }

    .entry {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 18px;
      border-bottom: 1px solid rgba(203, 213, 225, 0.12);
      font-weight: 600;
      border-radius: 10px;
      margin-bottom: 4px;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      color: #374151;
      background: rgba(255, 255, 255, 0.02);
    }

    .entry:hover {
      background: rgba(59, 130, 246, 0.04);
      transform: translateX(4px) scale(1.005);
      box-shadow: 
        0 4px 20px rgba(59, 130, 246, 0.05),
        inset 0 1px 0 rgba(255, 255, 255, 0.12);
      border-color: rgba(59, 130, 246, 0.12);
    }

    .entry:last-child {
      border-bottom: none;
    }

    .entry:nth-child(even) {
      background: rgba(241, 245, 249, 0.03);
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 28px;
      margin-top: 40px;
    }

    /* IMPROVED BOTTOM GRID STYLING FOR PROFESSIONAL LOOK */
    .bottom-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 24px;
      margin-top: 40px;
      align-items: stretch;
    }

    .bottom-grid .card {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      min-height: 140px;
      margin-bottom: 0;
    }

    .bottom-grid .section-title {
      margin-bottom: 12px;
    }

    .bottom-grid .value {
      margin-top: auto;
      margin-bottom: 8px;
    }

    .bottom-grid .meta {
      margin-top: auto;
    }

    /* Custom view specific grids */
    .custom-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 28px;
      margin-top: 40px;
    }

    .custom-bottom-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 24px;
      margin-top: 40px;
      align-items: stretch;
    }

    /* Weekly view specific grids */
    .weekly-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 24px;
      margin-top: 40px;
    }

    .weekly-bottom-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 24px;
      margin-top: 40px;
      align-items: stretch;
    }

    .value {
      font-size: 32px;
      font-weight: 900;
      background: linear-gradient(135deg, #1e40af 0%, #3b82f6 35%, #06b6d4 70%, #10b981 100%);
      background-size: 200% auto;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-top: 12px;
      letter-spacing: -1px;
      text-shadow: 0 0 20px rgba(59, 130, 246, 0.15);
      filter: drop-shadow(0 2px 4px rgba(59, 130, 246, 0.08));
    }

    /* Completed status styling */
    .value.completed {
      background: linear-gradient(135deg, #10b981 0%, #059669 35%, #047857 70%, #065f46 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 20px rgba(16, 185, 129, 0.15);
      filter: drop-shadow(0 2px 4px rgba(16, 185, 129, 0.08));
    }

    /* Special styling for weekly tracking alerts */
    .weekly-alert {
      padding: 16px 20px;
      border-radius: 12px;
      margin-top: 20px;
      font-weight: 600;
      font-size: 14px;
      border-left: 4px solid;
    }

    .weekly-alert.success {
      background: rgba(16, 185, 129, 0.1);
      color: #065f46;
      border-color: #10b981;
    }

    .weekly-alert.warning {
      background: rgba(245, 158, 11, 0.1);
      color: #92400e;
      border-color: #f59e0b;
    }

    .weekly-alert.danger {
      background: rgba(239, 68, 68, 0.1);
      color: #7f1d1d;
      border-color: #ef4444;
    }

    .footer {
      text-align: center;
      font-size: 14px;
      color: #64748b;
      font-weight: 600;
      margin-top: 48px;
      padding: 28px;
      background: rgba(255, 255, 255, 0.10);
      backdrop-filter: blur(25px) saturate(150%);
      -webkit-backdrop-filter: blur(25px) saturate(150%);
      border-radius: 20px;
      border: 1.5px solid rgba(255, 255, 255, 0.20);
      box-shadow: 
        0 12px 40px rgba(15, 23, 42, 0.04),
        inset 0 1px 0 rgba(255, 255, 255, 0.30),
        inset 0 -1px 0 rgba(255, 255, 255, 0.08);
      text-shadow: 0 1px 2px rgba(255, 255, 255, 0.5);
    }

    .welcome-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(15, 23, 42, 0.60);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10001;
      animation: modalFadeIn 0.5s ease-out;
    }

    .welcome-content {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(30px);
      -webkit-backdrop-filter: blur(30px);
      border-radius: 28px;
      border: 1.5px solid rgba(255, 255, 255, 0.40);
      box-shadow: 
        0 32px 80px rgba(15, 23, 42, 0.15),
        inset 0 2px 0 rgba(255, 255, 255, 0.50);
      padding: 48px;
      text-align: center;
      max-width: 500px;
      margin: 20px;
      animation: modalSlideIn 0.6s ease-out;
    }

    .welcome-greeting {
      font-size: 32px;
      font-weight: 800;
      margin-bottom: 16px;
      background: linear-gradient(135deg, #1e40af 0%, #3b82f6 35%, #06b6d4 70%, #10b981 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .welcome-message {
      font-size: 18px;
      color: #475569;
      margin-bottom: 32px;
      line-height: 1.6;
      font-weight: 500;
    }

    .welcome-close {
      background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      color: #ffffff;
      border: none;
      padding: 16px 32px;
      border-radius: 16px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 8px 25px rgba(59, 130, 246, 0.25);
    }

    .welcome-close:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 35px rgba(59, 130, 246, 0.35);
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 18px 28px;
      border-radius: 16px;
      backdrop-filter: blur(25px);
      -webkit-backdrop-filter: blur(25px);
      z-index: 10000;
      font-weight: 700;
      font-size: 14px;
      box-shadow: 0 12px 40px rgba(0,0,0,0.12);
      animation: slideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: 1.5px solid rgba(255, 255, 255, 0.2);
      letter-spacing: 0.5px;
      min-width: 280px;
      text-align: center;
      transition: all 0.2s ease;
    }

    .notification.error {
      background: linear-gradient(135deg, #dc2626 0%, #b91c1c 50%, #991b1b 100%);
      color: #ffffff;
      border-color: rgba(255, 255, 255, 0.3);
      box-shadow: 
        0 12px 40px rgba(220, 38, 38, 0.3),
        0 6px 20px rgba(185, 28, 28, 0.25),
        inset 0 1px 0 rgba(255, 255, 255, 0.2);
    }

    .notification.success {
      background: linear-gradient(135deg, #059669 0%, #047857 50%, #065f46 100%);
      color: #ffffff;
      border-color: rgba(255, 255, 255, 0.3);
      box-shadow: 
        0 12px 40px rgba(5, 150, 105, 0.3),
        0 6px 20px rgba(4, 120, 87, 0.25),
        inset 0 1px 0 rgba(255, 255, 255, 0.2);
    }

    .notification.info {
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 50%, #1d4ed8 100%);
      color: #ffffff;
      border-color: rgba(255, 255, 255, 0.3);
      box-shadow: 
        0 12px 40px rgba(59, 130, 246, 0.3),
        0 6px 20px rgba(37, 99, 235, 0.25),
        inset 0 1px 0 rgba(255, 255, 255, 0.2);
    }

    /* Enhanced mobile responsiveness */
    @media (max-width: 768px) {
      body {
        padding: 15px;
      }
      
      .container { 
        padding: 28px;
        border-radius: 24px;
      }
      
      h1 { 
        font-size: 28px; 
        margin-bottom: 24px;
      }
      
      .clock-container {
        flex-direction: column;
        gap: 16px;
      }
      
      .clock {
        font-size: 18px;
        padding: 20px 28px;
      }
      
      .card {
        padding: 28px;
        margin-bottom: 24px;
        border-radius: 20px;
      }
      
      .grid {
        grid-template-columns: 1fr;
        gap: 24px;
        margin-top: 32px;
      }

      .bottom-grid, .custom-grid, .custom-bottom-grid, .weekly-grid, .weekly-bottom-grid {
        grid-template-columns: 1fr;
        gap: 20px;
        margin-top: 32px;
      }
      
      .btn, .toggle-btn {
        width: 100%;
        justify-content: center;
        padding: 16px 28px;
        margin-bottom: 12px;
      }
      
      .nav-btn {
        padding: 14px 20px;
        font-size: 13px;
      }
      
      textarea {
        min-height: 140px;
        padding: 20px;
      }
      
      .value {
        font-size: 28px;
      }

      .checkbox-container {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }

      .radio-container {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }

      .custom-hours-input, .working-days-setup {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }

      .hours-input-group {
        flex-wrap: wrap;
      }

      .day-row {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }

      .status-options {
        width: 100%;
        justify-content: space-between;
        min-width: auto;
      }

      .time-inputs {
        margin-right: 0;
      }
    }

    @media (max-width: 480px) {
      .container {
        padding: 24px;
        border-radius: 20px;
      }
      
      .value {
        font-size: 24px;
      }
      
      .clock {
        font-size: 16px;
        padding: 16px 24px;
      }
      
      .card {
        padding: 24px;
        border-radius: 18px;
      }
      
      .grid, .bottom-grid, .custom-grid, .custom-bottom-grid, .weekly-grid, .weekly-bottom-grid {
        gap: 20px;
      }
    }

    /* Animation keyframes */
    @keyframes slideIn {
      from { 
        transform: translateX(100%) scale(0.95); 
        opacity: 0; 
      }
      to { 
        transform: translateX(0) scale(1); 
        opacity: 1; 
      }
    }

    @keyframes slideOut {
      from { 
        transform: translateX(0) scale(1); 
        opacity: 1; 
      }
      to { 
        transform: translateX(100%) scale(0.95); 
        opacity: 0; 
      }
    }

    @keyframes fadeInSlide {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes modalFadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(30px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    @keyframes smoothFadeIn {
      0% {
        opacity: 0;
        transform: translateY(8px) scale(0.99);
      }
      100% {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .card {
      animation: smoothFadeIn 0.4s ease-out;
    }

    .card:nth-child(2) { animation-delay: 0.03s; }
    .card:nth-child(3) { animation-delay: 0.06s; }
    .card:nth-child(4) { animation-delay: 0.09s; }
    .card:nth-child(5) { animation-delay: 0.12s; }

    /* Enhanced focus states */
    .btn:focus,
    .toggle-btn:focus,
    textarea:focus,
    .time-input:focus,
    .days-input:focus,
    .custom-checkbox input[type="checkbox"]:focus + .checkmark,
    .custom-radio input[type="radio"]:focus + .radio-checkmark {
      outline: 2px solid rgba(59, 130, 246, 0.3);
      outline-offset: 2px;
    }

    /* Performance optimizations */
    html {
      scroll-behavior: smooth;
    }

    .loading {
      opacity: 0.8;
      pointer-events: none;
    }

    .error-state {
      border-color: rgba(239, 68, 68, 0.25) !important;
      background: rgba(254, 226, 226, 0.04) !important;
    }

    .success-state {
      border-color: rgba(16, 185, 129, 0.25) !important;
      background: rgba(209, 250, 229, 0.04) !important;
    }

    @media (prefers-reduced-motion: reduce) {
      *,
      *::before,
      *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 style="color:#0077b6 !important;">⏱ Punch Tracker — Work & Break Analytics</h1>
    
    <!-- Clock and Navigation -->
    <div class="clock-container">
      <div class="clock" id="liveClock" aria-live="polite">--:--:--</div>
      <div style="display: flex; gap: 12px; flex-wrap: wrap; justify-content: center;">
        <button class="nav-btn active" onclick="switchView('main')" id="mainViewBtn">
          📊 Standard Tracking
        </button>
        <button class="nav-btn" onclick="switchView('custom')" id="customViewBtn">
          🎯 Custom Hours Target
        </button>
        <button class="nav-btn" onclick="switchView('weekly')" id="weeklyViewBtn">
          📅 Weekly Tracking
        </button>
      </div>
    </div>

    <!-- MAIN VIEW SECTION -->
    <div id="mainView" class="view-section active">
      <div class="card">
        <div class="section-title">Paste biometric punches (log format)</div>
        <textarea 
          id="autoInput" 
          placeholder="Example:-
08:45:43 PM
Punch Out
BIOMETRIC
05:00:57 PM
Punch In
BIOMETRIC
00h 35m 16s Break" 
          aria-label="Biometric punch log input"
          spellcheck="false"
          autocorrect="off"
          autocomplete="off"
          style="
            width: 100%;
            min-height: 160px;
            padding: 16px;
            font-size: 15px;
            line-height: 1.5;
            border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.4);
            background: rgba(255,255,255,0.25);
            box-shadow: 0 8px 24px rgba(0,0,0,0.05);
            backdrop-filter: blur(10px) saturate(140%);
            -webkit-backdrop-filter: blur(10px) saturate(140%);
            color: #0f3d52;
            resize: vertical;
          "></textarea>

        <!-- Error indication for main view -->
        <div class="error-indication" id="mainErrorIndication">
          ⚠️ Invalid log format detected. Please paste logs directly from the Portal with proper timestamps.
        </div>

        <!-- Double Punch Option -->
        <div class="checkbox-container">
          <label class="custom-checkbox">
            <input type="checkbox" id="doublePunchCheckbox">
            <span class="checkmark"></span>
          </label>
          <div style="flex: 1;">
            <label for="doublePunchCheckbox" class="checkbox-label">My logs contain double punches</label>
            <div class="checkbox-help">Check this if your punch logs have consecutive duplicate entries that need correction</div>
          </div>
        </div>

        <!-- Day Mode Selection -->
        <div class="radio-container">
          <div class="radio-option">
            <label class="custom-radio">
              <input type="radio" name="dayMode" value="present" id="presentDayRadio" checked>
              <span class="radio-checkmark"></span>
            </label>
            <label for="presentDayRadio" class="radio-label">Present Day</label>
          </div>
          <div class="radio-option">
            <label class="custom-radio">
              <input type="radio" name="dayMode" value="past" id="pastDayRadio">
              <span class="radio-checkmark"></span>
            </label>
            <label for="pastDayRadio" class="radio-label">Past Day</label>
          </div>
          <div style="font-size: 12px; color: #64748b; font-weight: 500; opacity: 0.8; margin-top: 4px; line-height: 1.4;">
            Select "Present Day" for today's punches (includes live time). Select "Past Day" for historical punch analysis.
          </div>
        </div>

        <div style="margin-top:24px; display:flex; align-items:center; gap:20px; flex-wrap:wrap;">
          <button 
            class="btn" 
            onclick="processAuto()" 
            aria-label="Process punch data"
            id="processBtn">
            ⚡ Process Punches
          </button>
          <button 
            class="btn btn-clear" 
            onclick="clearAll()" 
            aria-label="Clear all data"
            id="clearBtn">
            🗑️ Clear All
          </button>
          <span class="meta">Uses your local IST for live updates.</span>
        </div>
        
        <!-- Toggle button for showing processed punches -->
        <button 
          class="btn toggle-btn" 
          onclick="toggleProcessedPunches()"
          id="toggleBtn">
          👁️ View Processed Punches
        </button>
        
        <div class="log" id="logEntries" aria-label="Processed punch entries" role="log">
          <div class="entry" style="justify-content:center; color:#9ca3af;">
            No punches processed yet
          </div>
        </div>
      </div>

      <div class="grid">
        <div class="card">
          <div class="section-title">Total Work</div>
          <div class="value" id="totalWork" aria-live="polite">00:00:00</div>
          <div class="meta" id="workHuman"></div>
        </div>
        <div class="card">
          <div class="section-title">Total Break</div>
          <div class="value" id="totalBreak" aria-live="polite">00:00:00</div>
          <div class="meta" id="breakHuman"></div>
        </div>
        <div class="card">
          <div class="section-title">Logout — 6.5 hrs
            <div class="section-title-disclaimer">(If no further breaks are taken)</div>
          </div>
          <div class="value" id="logout65_no" aria-live="polite">--:--:--</div>
          <div class="meta" id="logout65NoMeta"></div>
        </div>
        <div class="card">
          <div class="section-title">Logout — 8 hrs
            <div class="section-title-disclaimer">(If no further breaks are taken)</div>
          </div>
          <div class="value" id="logout80_no" aria-live="polite">--:--:--</div>
          <div class="meta" id="logout80NoMeta"></div>
        </div>
        <div class="card">
          <div class="section-title">Extra Work
            <div class="section-title-disclaimer">(Beyond 8 hours)</div>
          </div>
          <div class="value" id="extraWork" aria-live="polite">00:00:00</div>
          <div class="meta" id="extraWorkMeta">Time worked beyond 8 hours</div>
        </div>
      </div>

      <!-- IMPROVED BOTTOM GRID SECTION -->
      <div class="bottom-grid">
        <div class="card">
          <div class="section-title">Time Left (6.5 hrs)</div>
          <div class="value" id="left65" aria-live="polite">06:30:00</div>
          <div class="meta">Time remaining to complete</div>
        </div>
        <div class="card">
          <div class="section-title">Time Left (8 hrs)</div>
          <div class="value" id="left80" aria-live="polite">08:00:00</div>
          <div class="meta">Time remaining to complete</div>
        </div>
        <div class="card">
          <div class="section-title">Break Remaining / Excess</div>
          <div class="value" id="breakRemaining" aria-live="polite">01:00:00</div>
          <div class="meta" id="breakNote">Allowed break: 1:00:00</div>
        </div>
      </div>
    </div>

    <!-- CUSTOM VIEW SECTION -->
    <div id="customView" class="view-section">
      <div class="card">
        <div class="section-title">Set Custom Working Hours Target</div>
        <div class="custom-hours-input">
          <div class="hours-input-group">
            <div class="time-label">Hours:</div>
            <input type="number" class="time-input" id="customHours" min="0" max="24" value="8" placeholder="8">
          </div>
          <div class="hours-input-group">
            <div class="time-label">Minutes:</div>
            <input type="number" class="time-input" id="customMinutes" min="0" max="59" value="0" placeholder="0">
          </div>
          <div style="font-size: 12px; color: #64748b; font-weight: 500; opacity: 0.8; line-height: 1.4;">
            Set your target working hours (e.g., 7 hours 30 minutes)
          </div>
        </div>

        <div class="section-title">Paste biometric punches (log format)</div>
        <textarea 
          id="customAutoInput" 
          placeholder="Example:-
08:45:43 PM
Punch Out
BIOMETRIC
05:00:57 PM
Punch In
BIOMETRIC
00h 35m 16s Break" 
          aria-label="Custom view biometric punch log input"
          spellcheck="false"
          autocorrect="off"
          autocomplete="off"
          style="
            width: 100%;
            min-height: 160px;
            padding: 16px;
            font-size: 15px;
            line-height: 1.5;
            border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.4);
            background: rgba(255,255,255,0.25);
            box-shadow: 0 8px 24px rgba(0,0,0,0.05);
            backdrop-filter: blur(10px) saturate(140%);
            -webkit-backdrop-filter: blur(10px) saturate(140%);
            color: #0f3d52;
            resize: vertical;
          "></textarea>

        <!-- Error indication for custom view -->
        <div class="error-indication" id="customErrorIndication">
          ⚠️ Invalid log format detected. Please paste logs directly from the Portal with proper timestamps.
        </div>

        <!-- Double Punch Option for Custom View -->
        <div class="checkbox-container">
          <label class="custom-checkbox">
            <input type="checkbox" id="customDoublePunchCheckbox">
            <span class="checkmark"></span>
          </label>
          <div style="flex: 1;">
            <label for="customDoublePunchCheckbox" class="checkbox-label">My logs contain double punches</label>
            <div class="checkbox-help">Check this if your punch logs have consecutive duplicate entries that need correction</div>
          </div>
        </div>

        <div style="margin-top:24px; display:flex; align-items:center; gap:20px; flex-wrap:wrap;">
          <button 
            class="btn" 
            onclick="processCustom()" 
            aria-label="Process custom punch data"
            id="customProcessBtn">
            ⚡ Process Punches
          </button>
          <button 
            class="btn btn-clear" 
            onclick="clearCustom()" 
            aria-label="Clear custom data"
            id="customClearBtn">
            🗑️ Clear All
          </button>
          <span class="meta">Custom target tracking with break compensation.</span>
        </div>
        
        <!-- Toggle button for showing processed punches in custom view -->
        <button 
          class="btn toggle-btn" 
          onclick="toggleCustomProcessedPunches()"
          id="customToggleBtn">
          👁️ View Processed Punches
        </button>
        
        <div class="log" id="customLogEntries" aria-label="Custom processed punch entries" role="log">
          <div class="entry" style="justify-content:center; color:#9ca3af;">
            No punches processed yet
          </div>
        </div>
      </div>

      <div class="custom-grid">
        <div class="card">
          <div class="section-title">Total Work</div>
          <div class="value" id="customTotalWork" aria-live="polite">00:00:00</div>
          <div class="meta" id="customWorkHuman"></div>
        </div>
        <div class="card">
          <div class="section-title">Total Break</div>
          <div class="value" id="customTotalBreak" aria-live="polite">00:00:00</div>
          <div class="meta" id="customBreakHuman"></div>
        </div>
      </div>

      <!-- Custom Target Results -->
      <div class="custom-bottom-grid">
        <div class="card">
          <div class="section-title">Custom Target Logout
            <div class="section-title-disclaimer">(If no further breaks are taken)</div>
          </div>
          <div class="value" id="customLogout" aria-live="polite">--:--:--</div>
          <div class="meta" id="customLogoutMeta"></div>
        </div>
        <div class="card">
          <div class="section-title">Time Left (Custom Target)</div>
          <div class="value" id="customTimeLeft" aria-live="polite">00:00:00</div>
          <div class="meta">Time remaining to complete target</div>
        </div>
      </div>
    </div>

    <!-- WEEKLY VIEW SECTION -->
    <div id="weeklyView" class="view-section">
      <div class="card">
        <!-- Working Days Setup -->
        <div class="section-title">Set Your Working Days This Week</div>
        <div class="working-days-setup">
          <div class="days-label">Number of working days:</div>
          <input type="number" class="days-input" id="workingDays" value="5" min="1" max="6" onchange="validateAndGenerateDayRows()">
          <div class="days-help">Set working days (1-6 max). Day 1, Day 2... will be generated up to your working days</div>
        </div>

        <!-- Dynamic Week Grid -->
        <div class="section-title">Previous Days & Current Day</div>
        <div id="dayRowsContainer">
          <!-- Dynamic day rows will be inserted here -->
        </div>

        <!-- Current Day Punch Logs -->
        <div class="section-title" style="margin-top: 30px;">Current Day Punch Logs</div>
        <textarea 
          id="weeklyPunchLogs" 
          placeholder="Paste your punch logs here:
08:45:43 PM
Punch Out
BIOMETRIC
05:00:57 PM
Punch In
BIOMETRIC
00h 35m 16s Break"
          aria-label="Weekly punch log input"
          spellcheck="false"
          autocorrect="off"
          autocomplete="off"
          style="
            width: 100%;
            min-height: 160px;
            padding: 16px;
            font-size: 15px;
            line-height: 1.5;
            border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.4);
            background: rgba(255,255,255,0.25);
            box-shadow: 0 8px 24px rgba(0,0,0,0.05);
            backdrop-filter: blur(10px) saturate(140%);
            -webkit-backdrop-filter: blur(10px) saturate(140%);
            color: #0f3d52;
            resize: vertical;
          "></textarea>

        <!-- Error indication for weekly view -->
        <div class="error-indication" id="weeklyErrorIndication">
          ⚠️ Invalid log format detected. Please paste logs directly from the Portal with proper timestamps.
        </div>

        <!-- Double Punch Option for Weekly View -->
        <div class="checkbox-container">
          <label class="custom-checkbox">
            <input type="checkbox" id="weeklyDoublePunchCheckbox">
            <span class="checkmark"></span>
          </label>
          <div style="flex: 1;">
            <label for="weeklyDoublePunchCheckbox" class="checkbox-label">My logs contain double punches</label>
            <div class="checkbox-help">Check this if your punch logs have consecutive duplicate entries that need correction</div>
          </div>
        </div>

        <div style="margin-top:24px; display:flex; align-items:center; gap:20px; flex-wrap:wrap;">
          <button 
            class="btn" 
            onclick="processWeekly()" 
            aria-label="Process weekly punch data"
            id="weeklyProcessBtn">
            ⚡ Process Weekly Requirements
          </button>
          <button 
            class="btn btn-clear" 
            onclick="clearWeekly()" 
            aria-label="Clear weekly data"
            id="weeklyClearBtn">
            🗑️ Clear All
          </button>
          <span class="meta">Weekly target tracking with break compensation.</span>
        </div>
        
        <!-- Toggle button for showing processed punches in weekly view -->
        <button 
          class="btn toggle-btn" 
          onclick="toggleWeeklyProcessedPunches()"
          id="weeklyToggleBtn">
          👁️ View Processed Punches
        </button>
        
        <div class="log" id="weeklyLogEntries" aria-label="Weekly processed punch entries" role="log">
          <div class="entry" style="justify-content:center; color:#9ca3af;">
            No punches processed yet
          </div>
        </div>
      </div>

      <!-- Weekly Summary Grid -->
      <div class="weekly-grid">
        <div class="card">
          <div class="section-title">Weekly Target</div>
          <div class="value" id="weeklyTarget" aria-live="polite">40:00:00</div>
          <div class="meta" id="weeklyTargetMeta">Based on working days</div>
        </div>
        
        <div class="card">
          <div class="section-title">Completed Hours</div>
          <div class="value" id="weeklyCompleted" aria-live="polite">00:00:00</div>
          <div class="meta" id="weeklyCompletedMeta">Previous + Current</div>
        </div>
        
        <div class="card">
          <div class="section-title">Current Day Work</div>
          <div class="value" id="weeklyCurrentWork" aria-live="polite">00:00:00</div>
          <div class="meta" id="weeklyCurrentWorkMeta">From punch logs</div>
        </div>

        <div class="card">
          <div class="section-title">Break Taken</div>
          <div class="value" id="weeklyBreakTaken" aria-live="polite">00:00:00</div>
          <div class="meta" id="weeklyBreakTakenMeta">Current day breaks</div>
        </div>
      </div>

      <!-- Weekly Target Results -->
      <div class="weekly-bottom-grid">
        <div class="card">
          <div class="section-title">Today's Requirement
            <div class="section-title-disclaimer">(To meet weekly target)</div>
          </div>
          <div class="value" id="weeklyTodayReq" aria-live="polite">08:00:00</div>
          <div class="meta" id="weeklyTodayReqMeta">Daily min vs Weekly need</div>
        </div>
        <div class="card">
          <div class="section-title">Recommended Logout
            <div class="section-title-disclaimer">(If no further breaks are taken)</div>
          </div>
          <div class="value" id="weeklyRecommendedLogout" aria-live="polite">--:--:--</div>
          <div class="meta" id="weeklyLogoutMeta">Includes break compensation</div>
        </div>
      </div>

      <!-- Weekly Alert -->
      <div id="weeklyAlertContainer">
        <!-- Dynamic weekly alerts will appear here -->
      </div>
    </div>

    <div class="footer">
      © 2025 Punch Tracker | Developed by Quick Break Team 🚀✨
    </div>
  </div>

  <!-- Welcome Modal -->
  <div class="welcome-modal" id="welcomeModal">
    <div class="welcome-content">
      <div class="welcome-greeting" id="welcomeGreeting">Good Morning! 🌅</div>
      <div class="welcome-message" id="welcomeMessage">
        Welcome to Punch Tracker! Ready to track your work hours efficiently? 😊<br><br>
        Have a productive and wonderful day! ✨🎉
      </div>
      <button class="welcome-close" onclick="closeWelcomeModal()">
        Get Started 🚀
      </button>
    </div>
  </div>

  <script>
    // Enhanced error handling and fault tolerance
    let clockInterval = null;
    let isProcessing = false;
    let isPunchesVisible = false;
    let isCustomPunchesVisible = false;
    let isWeeklyPunchesVisible = false;
    let currentView = 'main';

    // Constants for calculations
    const WEEKLY_TARGET_PER_DAY = 8;
    const DAILY_MINIMUM_FULL = 6.5;
    const DAILY_MINIMUM_HALF = 4;
    const ALLOWED_BREAK_PER_DAY = 1; // 1 hour
    const HALF_DAY_HOURS = 4;
    const MAX_WORKING_DAYS = 6;

    // View switching functionality
    function switchView(viewName) {
      const mainView = document.getElementById('mainView');
      const customView = document.getElementById('customView');
      const weeklyView = document.getElementById('weeklyView');
      const mainBtn = document.getElementById('mainViewBtn');
      const customBtn = document.getElementById('customViewBtn');
      const weeklyBtn = document.getElementById('weeklyViewBtn');

      // Remove active class from all views and buttons
      [mainView, customView, weeklyView].forEach(view => view.classList.remove('active'));
      [mainBtn, customBtn, weeklyBtn].forEach(btn => btn.classList.remove('active'));

      // Activate selected view and button
      if (viewName === 'main') {
        mainView.classList.add('active');
        mainBtn.classList.add('active');
      } else if (viewName === 'custom') {
        customView.classList.add('active');
        customBtn.classList.add('active');
      } else if (viewName === 'weekly') {
        weeklyView.classList.add('active');
        weeklyBtn.classList.add('active');
      }

      currentView = viewName;
    }

    // UPDATED: Validate working days and generate day rows with error handling
    function validateAndGenerateDayRows() {
      const workingDaysInput = document.getElementById('workingDays');
      const workingDays = parseInt(workingDaysInput.value);
      
      // Clear previous error state
      workingDaysInput.classList.remove('error');
      
      // Validation checks
      if (isNaN(workingDays) || workingDays < 1) {
        workingDaysInput.value = 1;
        workingDaysInput.classList.add('error');
        showNotification('Working days must be at least 1', 'error');
        generateDayRows(1);
        return;
      }
      
      if (workingDays > MAX_WORKING_DAYS) {
        workingDaysInput.value = MAX_WORKING_DAYS;
        workingDaysInput.classList.add('error');
        showNotification(`Working days cannot exceed ${MAX_WORKING_DAYS}`, 'error');
        generateDayRows(MAX_WORKING_DAYS);
        return;
      }
      
      generateDayRows(workingDays);
    }

    // UPDATED: Generate dynamic day rows for weekly view (simplified to Full Day / Half Day)
    function generateDayRows(workingDays = null) {
      if (workingDays === null) {
        workingDays = parseInt(document.getElementById('workingDays').value) || 5;
      }
      
      const container = document.getElementById('dayRowsContainer');
      container.innerHTML = '';

      for (let i = 1; i <= workingDays; i++) {
        const isCurrentDay = (i === workingDays);
        const dayRow = document.createElement('div');
        dayRow.className = `day-row ${isCurrentDay ? 'current-day' : ''}`;
        
        dayRow.innerHTML = `
          <div class="day-label">Day ${i}${isCurrentDay ? ' (Today)' : ''}</div>
          ${!isCurrentDay ? `
            <div class="time-inputs">
              <input type="number" class="time-input" id="day${i}-hours" placeholder="0" min="0" max="24" step="1">
              <span class="time-label">h</span>
              <input type="number" class="time-input" id="day${i}-minutes" placeholder="0" min="0" max="59" step="1">
              <span class="time-label">m</span>
            </div>
            <div class="status-options">
              <div class="status-option full-day">
                <input type="radio" name="day${i}-status" value="full" id="day${i}-full" checked>
                <label for="day${i}-full">Full Day</label>
              </div>
              <div class="status-option half-day">
                <input type="radio" name="day${i}-status" value="half" id="day${i}-half">
                <label for="day${i}-half">Half Day</label>
              </div>
            </div>
          ` : `
            <div style="color: #059669; font-weight: 500; font-style: italic;">
              Current day - calculated from punch logs below
            </div>
          `}
        `;
        
        container.appendChild(dayRow);
      }
    }

    // UPDATED log validation function for biometric portal format
function validateLogFormat(text) {
  if (!text || typeof text !== 'string' || text.trim().length === 0) {
    return { isValid: false, error: 'No input provided' };
  }

  const lines = text.split(/\r?\n/).map(l => l.trim()).filter(Boolean);
  
  if (lines.length === 0) {
    return { isValid: false, error: 'No valid lines found' };
  }

  const timeRegex = /^(\d{1,2}:\d{2}:\d{2}\s?(AM|PM))$/i;
  const punchRegex = /^(Punch\s+(In|Out))$/i;
  const biometricRegex = /^BIOMETRIC$/i;
  const breakRegex = /^\d{2}h\s+\d{2}m\s+\d{2}s\s+Break$/i;
  
  let validTimeLines = 0;
  let validPunchLines = 0;
  let validBiometricLines = 0;
  let totalSignificantLines = 0;

  for (const line of lines) {
    if (timeRegex.test(line)) {
      validTimeLines++;
      totalSignificantLines++;
    } else if (punchRegex.test(line)) {
      validPunchLines++;
      totalSignificantLines++;
    } else if (biometricRegex.test(line)) {
      validBiometricLines++;
      totalSignificantLines++;
    } else if (breakRegex.test(line)) {
      // Break lines are valid but don't count as significant
      continue;
    } else if (line.length > 2) {
      // Unknown format line
      return { isValid: false, error: 'Unknown format detected in logs' };
    }
  }

  // UPDATED: Check if we have at least ONE valid punch entry (for single punch scenarios)
  if (validTimeLines < 1) {
    return { isValid: false, error: 'No time entries found' };
  }

  if (validPunchLines < 1) {
    return { isValid: false, error: 'No punch entries found' };
  }

  // Basic ratio validation - time and punch lines should match
  if (validTimeLines !== validPunchLines) {
    return { isValid: false, error: 'Mismatch between time and punch entries' };
  }

  return { isValid: true };
}


    function showErrorIndication(elementId, show = true) {
      const errorEl = document.getElementById(elementId);
      if (errorEl) {
        errorEl.style.display = show ? 'block' : 'none';
      }
    }

    // Show welcome modal based on time of day
    function showWelcomeModal() {
      try {
        const now = new Date();
        const istOffset = 5.5 * 60 * 60 * 1000;
        const localOffset = now.getTimezoneOffset() * 60000;
        const istTime = new Date(now.getTime() + istOffset + localOffset);
        const hour = istTime.getHours();
        
        let greeting, message;
        
        if (hour >= 5 && hour < 12) {
          greeting = `Good Morning! <span style="-webkit-text-fill-color: initial; background: none; background-clip: border-box;">🌅😊</span>`;
          message = "Welcome to Punch Tracker! Ready to start your productive day? 💪<br><br>Have a wonderful and successful morning! ☀️✨";
        } else if (hour >= 12 && hour < 17) {
          greeting = `Good Afternoon! <span style="-webkit-text-fill-color: initial; background: none; background-clip: border-box;">☀️😊</span>`;
          message = "Welcome to Punch Tracker! Hope you're having a great day so far! 💼<br><br>Have a productive and amazing afternoon! 🌞🎯";
        } else if (hour >= 17 && hour < 22) {
          greeting = `Good Evening! <span style="-webkit-text-fill-color: initial; background: none; background-clip: border-box;">🌆😊</span>`;
          message = "Welcome to Punch Tracker! Time to wrap up your day efficiently! 📋<br><br>Have a peaceful and relaxing evening! 🌙✨";
        } else {
          greeting = `Hello Night Owl! <span style="-webkit-text-fill-color: initial; background: none; background-clip: border-box;">🌙😊</span>`;
          message = "Welcome to Punch Tracker! Working late? Let's track those hours! 💻<br><br>Take care and have a good night! 🌟💤";
        }
        
        document.getElementById('welcomeGreeting').innerHTML = greeting;
        document.getElementById('welcomeMessage').innerHTML = message;
        document.getElementById('welcomeModal').style.display = 'flex';
        
      } catch (error) {
        console.error('Welcome modal error:', error);
      }
    }

    function closeWelcomeModal() {
      const modal = document.getElementById('welcomeModal');
      modal.style.animation = 'modalFadeIn 0.3s ease-out reverse';
      setTimeout(() => {
        modal.style.display = 'none';
      }, 300);
    }

    // Toggle processed punches visibility for main view
    function toggleProcessedPunches() {
      const logSection = document.getElementById('logEntries');
      const toggleBtn = document.getElementById('toggleBtn');
      
      if (isPunchesVisible) {
        logSection.classList.remove('visible');
        toggleBtn.innerHTML = '👁️ View Processed Punches';
        toggleBtn.classList.remove('active');
        isPunchesVisible = false;
      } else {
        logSection.classList.add('visible');
        toggleBtn.innerHTML = '🙈 Hide Processed Punches';
        toggleBtn.classList.add('active');
        isPunchesVisible = true;
      }
    }

    // Toggle processed punches visibility for custom view
    function toggleCustomProcessedPunches() {
      const logSection = document.getElementById('customLogEntries');
      const toggleBtn = document.getElementById('customToggleBtn');
      
      if (isCustomPunchesVisible) {
        logSection.classList.remove('visible');
        toggleBtn.innerHTML = '👁️ View Processed Punches';
        toggleBtn.classList.remove('active');
        isCustomPunchesVisible = false;
      } else {
        logSection.classList.add('visible');
        toggleBtn.innerHTML = '🙈 Hide Processed Punches';
        toggleBtn.classList.add('active');
        isCustomPunchesVisible = true;
      }
    }

    // Toggle processed punches visibility for weekly view
    function toggleWeeklyProcessedPunches() {
      const logSection = document.getElementById('weeklyLogEntries');
      const toggleBtn = document.getElementById('weeklyToggleBtn');
      
      if (isWeeklyPunchesVisible) {
        logSection.classList.remove('visible');
        toggleBtn.innerHTML = '👁️ View Processed Punches';
        toggleBtn.classList.remove('active');
        isWeeklyPunchesVisible = false;
      } else {
        logSection.classList.add('visible');
        toggleBtn.innerHTML = '🙈 Hide Processed Punches';
        toggleBtn.classList.add('active');
        isWeeklyPunchesVisible = true;
      }
    }

    // Clear all function for main view
    function clearAll() {
      try {
        // Clear textarea
        document.getElementById('autoInput').value = '';
        
        // Clear checkbox
        document.getElementById('doublePunchCheckbox').checked = false;
        
        // Reset radio buttons to Present Day
        document.getElementById('presentDayRadio').checked = true;
        document.getElementById('pastDayRadio').checked = false;
        
        // Hide error indication
        showErrorIndication('mainErrorIndication', false);
        
        // Clear log entries
        const logEl = document.getElementById('logEntries');
        logEl.innerHTML = '<div class="entry" style="justify-content:center; color:#9ca3af;">No punches processed yet</div>';
        
        // Hide processed punches section
        logEl.classList.remove('visible');
        const toggleBtn = document.getElementById('toggleBtn');
        toggleBtn.innerHTML = '👁️ View Processed Punches';
        toggleBtn.classList.remove('active');
        isPunchesVisible = false;
        
        // Reset all values to default
        const defaultValues = {
          'totalWork': '00:00:00',
          'totalBreak': '00:00:00',
          'logout65_no': '--:--:--',
          'logout80_no': '--:--:--',
          'extraWork': '00:00:00',
          'left65': '06:30:00',
          'left80': '08:00:00',
          'breakRemaining': '01:00:00'
        };
        
        const defaultMeta = {
          'workHuman': '',
          'breakHuman': '',
          'extraWorkMeta': 'Time worked beyond 8 hours',
          'breakNote': 'Allowed break: 1:00:00',
          'logout65NoMeta': '',
          'logout80NoMeta': ''
        };
        
        // Update all values
        for (const [id, value] of Object.entries(defaultValues)) {
          const element = document.getElementById(id);
          if (element) {
            element.textContent = value;
            element.classList.remove('error-state', 'success-state', 'completed');
          }
        }
        
        // Update meta information
        for (const [id, value] of Object.entries(defaultMeta)) {
          const element = document.getElementById(id);
          if (element) {
            element.textContent = value;
            element.classList.remove('meta-info');
          }
        }
        
        // Success notification
        showNotification('All data cleared successfully! 🧹', 'success');
        
      } catch (error) {
        console.error('Clear function error:', error);
        showNotification('Error clearing data', 'error');
      }
    }

    // Clear all function for custom view
    function clearCustom() {
      try {
        // Clear textarea
        document.getElementById('customAutoInput').value = '';
        
        // Clear checkbox
        document.getElementById('customDoublePunchCheckbox').checked = false;
        
        // Reset custom hours
        document.getElementById('customHours').value = '8';
        document.getElementById('customMinutes').value = '0';
        
        // Hide error indication
        showErrorIndication('customErrorIndication', false);
        
        // Clear log entries
        const logEl = document.getElementById('customLogEntries');
        logEl.innerHTML = '<div class="entry" style="justify-content:center; color:#9ca3af;">No punches processed yet</div>';
        
        // Hide processed punches section
        logEl.classList.remove('visible');
        const toggleBtn = document.getElementById('customToggleBtn');
        toggleBtn.innerHTML = '👁️ View Processed Punches';
        toggleBtn.classList.remove('active');
        isCustomPunchesVisible = false;
        
        // Reset all values to default
        const defaultValues = {
          'customTotalWork': '00:00:00',
          'customTotalBreak': '00:00:00',
          'customLogout': '--:--:--',
          'customTimeLeft': '08:00:00'
        };
        
        const defaultMeta = {
          'customWorkHuman': '',
          'customBreakHuman': '',
          'customLogoutMeta': ''
        };
        
        // Update all values
        for (const [id, value] of Object.entries(defaultValues)) {
          const element = document.getElementById(id);
          if (element) {
            element.textContent = value;
            element.classList.remove('error-state', 'success-state', 'completed');
          }
        }
        
        // Update meta information
        for (const [id, value] of Object.entries(defaultMeta)) {
          const element = document.getElementById(id);
          if (element) {
            element.textContent = value;
            element.classList.remove('meta-info');
          }
        }
        
        // Success notification
        showNotification('Custom view cleared successfully! 🧹', 'success');
        
      } catch (error) {
        console.error('Clear custom function error:', error);
        showNotification('Error clearing custom data', 'error');
      }
    }

    // UPDATED: Clear all function for weekly view with error handling
    function clearWeekly() {
      try {
        // Clear textarea
        document.getElementById('weeklyPunchLogs').value = '';
        
        // Clear checkbox
        document.getElementById('weeklyDoublePunchCheckbox').checked = false;
        
        // Reset working days with validation
        const workingDaysInput = document.getElementById('workingDays');
        workingDaysInput.value = '5';
        workingDaysInput.classList.remove('error');
        generateDayRows(5);
        
        // Hide error indication
        showErrorIndication('weeklyErrorIndication', false);
        
        // Clear log entries
        const logEl = document.getElementById('weeklyLogEntries');
        logEl.innerHTML = '<div class="entry" style="justify-content:center; color:#9ca3af;">No punches processed yet</div>';
        
        // Hide processed punches section
        logEl.classList.remove('visible');
        const toggleBtn = document.getElementById('weeklyToggleBtn');
        toggleBtn.innerHTML = '👁️ View Processed Punches';
        toggleBtn.classList.remove('active');
        isWeeklyPunchesVisible = false;
        
        // Reset all values to default
        const defaultValues = {
          'weeklyTarget': '40:00:00',
          'weeklyCompleted': '00:00:00',
          'weeklyCurrentWork': '00:00:00',
          'weeklyBreakTaken': '00:00:00',
          'weeklyTodayReq': '08:00:00',
          'weeklyRecommendedLogout': '--:--:--'
        };
        
        const defaultMeta = {
          'weeklyTargetMeta': 'Based on working days',
          'weeklyCompletedMeta': 'Previous + Current',
          'weeklyCurrentWorkMeta': 'From punch logs',
          'weeklyBreakTakenMeta': 'Current day breaks',
          'weeklyTodayReqMeta': 'Daily min vs Weekly need',
          'weeklyLogoutMeta': 'Includes break compensation'
        };
        
        // Update all values
        for (const [id, value] of Object.entries(defaultValues)) {
          const element = document.getElementById(id);
          if (element) {
            element.textContent = value;
            element.classList.remove('error-state', 'success-state', 'completed');
          }
        }
        
        // Update meta information
        for (const [id, value] of Object.entries(defaultMeta)) {
          const element = document.getElementById(id);
          if (element) {
            element.textContent = value;
            element.classList.remove('meta-info');
          }
        }
        
        // Clear alerts
        document.getElementById('weeklyAlertContainer').innerHTML = '';
        
        // Success notification
        showNotification('Weekly view cleared successfully! 🧹', 'success');
        
      } catch (error) {
        console.error('Clear weekly function error:', error);
        showNotification('Error clearing weekly data', 'error');
      }
    }

    // Enhanced notification system with red gradient for errors
    function showNotification(message, type = 'info') {
      try {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.textContent = message;
        
        // Add icon based on type
        const icon = type === 'error' ? '🚫' : type === 'success' ? '✅' : 'ℹ️';
        notification.textContent = `${icon} ${message}`;
        
        document.body.appendChild(notification);
        
        // Auto remove after 4 seconds
        setTimeout(() => {
          notification.style.animation = 'slideOut 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
          setTimeout(() => {
            if (notification.parentNode) {
              notification.remove();
            }
          }, 300);
        }, 4000);
        
        // Allow manual dismissal on click
        notification.addEventListener('click', () => {
          notification.style.animation = 'slideOut 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
          setTimeout(() => {
            if (notification.parentNode) {
              notification.remove();
            }
          }, 300);
        });
        
      } catch (error) {
        console.error('Notification error:', error);
        alert(message);
      }
    }

    // Robust clock updater with error recovery
    function updateClock() {
      try {
        const now = new Date();
        
        if (isNaN(now.getTime())) {
          throw new Error('Invalid date object');
        }

        const istOffset = 5.5 * 60 * 60 * 1000;
        const localOffset = now.getTimezoneOffset() * 60000;
        const istTime = new Date(now.getTime() + istOffset + localOffset);
        
        if (isNaN(istTime.getTime())) {
          throw new Error('IST calculation failed');
        }

        const dateStr = istTime.toLocaleDateString('en-GB', {
          day: '2-digit', 
          month: 'short', 
          year: 'numeric'
        });
        
        const timeStr = istTime.toLocaleTimeString([], {
          hour: '2-digit', 
          minute: '2-digit', 
          second: '2-digit', 
          hour12: true
        });
        
        const clockElement = document.getElementById("liveClock");
        if (clockElement) {
          clockElement.textContent = `${dateStr} | ${timeStr} IST`;
          clockElement.setAttribute('title', `Current IST Time: ${dateStr} ${timeStr}`);
          clockElement.classList.remove('error-state');
        }
      } catch (error) {
        console.error('Clock update error:', error);
        const clockElement = document.getElementById("liveClock");
        if (clockElement) {
          clockElement.textContent = 'Clock Error - Please Refresh';
          clockElement.classList.add('error-state');
        }
        
        setTimeout(() => {
          if (clockInterval) {
            clearInterval(clockInterval);
            clockInterval = setInterval(updateClock, 1000);
          }
        }, 5000);
      }
    }

    // Initialize clock with error handling
    try {
      updateClock();
      clockInterval = setInterval(updateClock, 1000);
    } catch (error) {
      console.error('Clock initialization failed:', error);
    }

    // Enhanced utility functions with comprehensive error handling
    function parseTimeToSec(time12) {
      try {
        if (!time12 || typeof time12 !== 'string') {
          throw new Error('Invalid time input');
        }

        const trimmed = time12.trim();
        const parts = trimmed.split(/\s+/);
        
        if (parts.length !== 2) {
          throw new Error('Invalid time format - expected "HH:MM:SS AM/PM"');
        }
        
        const timePart = parts[0].split(":").map(x => {
          const num = parseInt(x, 10);
          if (isNaN(num)) throw new Error(`Invalid time component: ${x}`);
          return num;
        });
        
        const meridiem = parts[1].toUpperCase();
        
        if (!['AM', 'PM'].includes(meridiem)) {
          throw new Error('Invalid meridiem - must be AM or PM');
        }
        
        if (timePart.length < 2 || timePart.length > 3) {
          throw new Error('Invalid time components count');
        }
        
        let hh = timePart[0], mm = timePart[1] || 0, ss = timePart[2] || 0;
        
        if (hh < 1 || hh > 12) throw new Error('Invalid hour');
        if (mm < 0 || mm > 59) throw new Error('Invalid minute');
        if (ss < 0 || ss > 59) throw new Error('Invalid second');
        
        if (meridiem === "PM" && hh !== 12) hh += 12;
        if (meridiem === "AM" && hh === 12) hh = 0;
        
        const result = hh * 3600 + mm * 60 + ss;
        
        if (result < 0 || result >= 86400) {
          throw new Error('Time out of valid range');
        }
        
        return result;
      } catch (error) {
        console.error('Time parsing error:', error.message, 'Input:', time12);
        return null;
      }
    }

    function secToHms(sec) {
      try {
        if (typeof sec !== 'number' || isNaN(sec)) {
          throw new Error('Invalid seconds input');
        }
        
        if (sec < 0) sec = 0;
        if (sec > 86400 * 7) {
          console.warn('Unusually large time value:', sec);
          sec = 86400 * 7;
        }
        
        const hh = Math.floor(sec / 3600);
        sec -= hh * 3600;
        const mm = Math.floor(sec / 60);
        sec -= mm * 60;
        const ss = Math.floor(sec);
        
        return [hh, mm, ss].map(n => String(n).padStart(2, '0')).join(':');
      } catch (error) {
        console.error('Time formatting error:', error);
        return '00:00:00';
      }
    }

    function secToTimeStringFromNowAdd(sec) {
      try {
        if (typeof sec !== 'number' || isNaN(sec) || sec < 0) {
          return "Invalid";
        }
        
        const now = new Date();
        if (isNaN(now.getTime())) {
          throw new Error('Invalid current time');
        }
        
        const then = new Date(now.getTime() + sec * 1000);
        if (isNaN(then.getTime())) {
          throw new Error('Invalid future time calculation');
        }
        
        return then.toLocaleTimeString([], {
          hour: '2-digit',
          minute: '2-digit',
          second: '2-digit',
          hour12: true
        });
      } catch (error) {
        console.error('Future time calculation error:', error);
        return "Error";
      }
    }

    // Parse break duration from format "00h 35m 16s Break"
    function parseBreakDuration(breakLine) {
      try {
        const match = breakLine.match(/(\d{2})h\s+(\d{2})m\s+(\d{2})s\s+Break/i);
        if (match) {
          const hours = parseInt(match[1], 10);
          const minutes = parseInt(match[2], 10);
          const seconds = parseInt(match[3], 10);
          return hours * 3600 + minutes * 60 + seconds;
        }
        return 0;
      } catch (error) {
        console.error('Break duration parsing error:', error);
        return 0;
      }
    }

    // UPDATED parsing function for biometric portal format
    function parsePunches(text, handleDoublePunches = false) {
      try {
        if (!text || typeof text !== 'string') {
          return { punches: [], errors: ['No input provided'], totalExplicitBreaks: 0 };
        }
        
        const lines = text.split(/\r?\n/).map(l => l.trim()).filter(Boolean);
        
        if (lines.length === 0) {
          return { punches: [], errors: ['No valid lines found'], totalExplicitBreaks: 0 };
        }
        
        const punches = [];
        const errors = [];
        let totalExplicitBreaks = 0;
        const timeRegex = /^(\d{1,2}:\d{2}:\d{2}\s?(AM|PM))$/i;
        const punchRegex = /^(Punch\s+(In|Out))$/i;
        const breakRegex = /^\d{2}h\s+\d{2}m\s+\d{2}s\s+Break$/i;
        
        for (let i = 0; i < lines.length; i++) {
          try {
            // Check for break duration line
            if (breakRegex.test(lines[i])) {
              const breakDuration = parseBreakDuration(lines[i]);
              totalExplicitBreaks += breakDuration;
              continue;
            }

            // Check for time line
            const timeMatch = lines[i].match(timeRegex);
            if (timeMatch) {
              // Look for the punch action in the next line
              if (i + 1 < lines.length) {
                const punchMatch = lines[i + 1].match(punchRegex);
                if (punchMatch) {
                  const timeSec = parseTimeToSec(timeMatch[1]);
                  if (timeSec !== null) {
                    const action = punchMatch[1].includes('In') ? 'Punch In' : 'Punch Out';
                    punches.push({
                      timeSec: timeSec,
                      display: timeMatch[1].toUpperCase(),
                      action: action,
                      lineNumber: i + 1
                    });
                  } else {
                    errors.push(`Line ${i + 1}: Invalid time format "${timeMatch[1]}"`);
                  }
                }
              }
            }
          } catch (error) {
            errors.push(`Line ${i + 1}: ${error.message}`);
          }
        }
        
        try {
          punches.sort((a, b) => a.timeSec - b.timeSec);
        } catch (error) {
          errors.push('Failed to sort punches by time');
        }
        
        if (handleDoublePunches) {
          try {
            for (let i = 1; i < punches.length; i++) {
              if (punches[i].timeSec - punches[i - 1].timeSec <= 60) {
                punches[i].action = punches[i].action === "Punch In" ? "Punch Out" : "Punch In";
                for (let j = i + 1; j < punches.length; j++) {
                  punches[j].action = punches[j].action === "Punch In" ? "Punch Out" : "Punch In";
                }
              }
            }
          } catch (error) {
            errors.push('Failed to process consecutive punches');
          }
        }
        
        return { punches, errors, totalExplicitBreaks };
      } catch (error) {
        console.error('Punch parsing critical error:', error);
        return { punches: [], errors: ['Critical parsing error: ' + error.message], totalExplicitBreaks: 0 };
      }
    }

    // Calculate current day work from punch logs
    function calculateCurrentDayWork(text, handleDoublePunches = false) {
      const { punches, totalExplicitBreaks } = parsePunches(text, handleDoublePunches);
      
      let totalWork = 0, totalBreak = totalExplicitBreaks;
      let lastType = null, lastTime = null;
      
      for (const p of punches) {
        if (lastType === "in" && p.action === "Punch Out") {
          const workTime = p.timeSec - lastTime;
          if (workTime > 0) totalWork += workTime;
        }
        if (lastType === "out" && p.action === "Punch In") {
          const breakTime = p.timeSec - lastTime;
          if (breakTime > 0 && totalExplicitBreaks === 0) {
            totalBreak += breakTime;
          }
        }
        lastType = p.action === "Punch In" ? "in" : "out";
        lastTime = p.timeSec;
      }
      
      // Add current work if punched in
      if (lastType === "in" && lastTime !== null) {
        const now = new Date();
        const nowSec = now.getHours() * 3600 + now.getMinutes() * 60 + now.getSeconds();
        const currentWork = nowSec - lastTime;
        if (currentWork > 0) totalWork += currentWork;
      }
      
      return { totalWork, totalBreak, punches };
    }

    // ENHANCED processing function for main view with updated validation
    function processAuto() {
      if (isProcessing) {
        showNotification('Processing already in progress', 'info');
        return;
      }
      
      try {
        isProcessing = true;
        
        const btn = document.querySelector('#processBtn');
        const originalText = btn.innerHTML;
        btn.innerHTML = '⏳ Processing...';
        btn.disabled = true;
        btn.classList.add('loading');
        
        setTimeout(() => {
          try {
            const txt = document.getElementById('autoInput').value;
            
            // Enhanced validation
            const validation = validateLogFormat(txt);
            if (!validation.isValid) {
              showErrorIndication('mainErrorIndication', true);
              showNotification('Invalid log format detected! ' + validation.error, 'error');
              return;
            } else {
              showErrorIndication('mainErrorIndication', false);
            }
            
            const handleDoublePunches = document.getElementById('doublePunchCheckbox').checked;
            const isPresentDay = document.getElementById('presentDayRadio').checked;
            
            const result = parsePunches(txt, handleDoublePunches);
            const { punches, errors, totalExplicitBreaks } = result;
            const logEl = document.getElementById('logEntries');
            
            if (!logEl) {
              throw new Error('Log element not found - DOM may be corrupted');
            }
            
            logEl.innerHTML = '';
            
            if (errors.length > 0) {
              console.warn('Parsing errors:', errors);
            }
            
            if (punches.length === 0) {
              logEl.innerHTML = `
                <div class="entry" style="justify-content:center; color:#ef4444;">
                  ${errors.length > 0 ? `Parsing errors found. Please check input format.` : 'No valid punches found'}
                </div>`;
              
              if (errors.length > 0) {
                showNotification(`Found ${errors.length} parsing error(s)`, 'error');
              }
            } else {
              punches.slice().reverse().forEach((p, index) => {
                try {
                  const div = document.createElement('div');
                  div.className = "entry";
                  div.innerHTML = `<span>${p.display}</span><span>${p.action}</span>`;
                  div.setAttribute('title', `${p.action} at ${p.display} (Line ${p.lineNumber || 'Unknown'})`);
                  div.style.animationDelay = `${index * 0.05}s`;
                  logEl.appendChild(div);
                } catch (error) {
                  console.error('Error creating log entry:', error);
                }
              });
            }
            
            let totalWork = 0, totalBreak = totalExplicitBreaks;
            let lastType = null, lastTime = null;
            
            try {
              for (const p of punches) {
                if (lastType === "in" && p.action === "Punch Out") {
                  const workTime = p.timeSec - lastTime;
                  if (workTime > 0 && workTime < 86400) {
                    totalWork += workTime;
                  }
                }
                if (lastType === "out" && p.action === "Punch In") {
                  const breakTime = p.timeSec - lastTime;
                  if (breakTime > 0 && breakTime < 86400) {
                    // Only add implicit break if no explicit breaks were found
                    if (totalExplicitBreaks === 0) {
                      totalBreak += breakTime;
                    }
                  }
                }
                if (p.action === "Punch In") {
                  lastType = "in";
                  lastTime = p.timeSec;
                }
                if (p.action === "Punch Out") {
                  lastType = "out";
                  lastTime = p.timeSec;
                }
              }
              
              if (isPresentDay && lastType === "in" && lastTime !== null) {
                try {
                  const now = new Date();
                  const nowSec = now.getHours() * 3600 + now.getMinutes() * 60 + now.getSeconds();
                  const currentWork = nowSec - lastTime;
                  if (currentWork > 0 && currentWork < 86400) {
                    totalWork += currentWork;
                  }
                } catch (error) {
                  console.error('Error calculating current work time:', error);
                }
              }
            } catch (error) {
              console.error('Error calculating work/break times:', error);
              showNotification('Error calculating times', 'error');
            }
            
            const allowedBreak = 3600;
            const breakExcess = Math.max(0, totalBreak - allowedBreak);
            const breakRemaining = Math.max(0, allowedBreak - totalBreak);
            
            const targets = [
              { label: "6.5", secs: 23400 + breakExcess },
              { label: "8", secs: 28800 + breakExcess }
            ];
            
            const updateElement = (id, value, isCompleted = false) => {
              try {
                const element = document.getElementById(id);
                if (element) {
                  element.textContent = value;
                  element.classList.remove('error-state', 'completed');
                  if (isCompleted) {
                    element.classList.add('completed');
                  } else {
                    element.classList.add('success-state');
                    setTimeout(() => element.classList.remove('success-state'), 2000);
                  }
                } else {
                  console.warn(`Element with id '${id}' not found`);
                }
              } catch (error) {
                console.error(`Error updating element ${id}:`, error);
              }
            };

            const updateMeta = (id, value, isInfo = false) => {
              try {
                const element = document.getElementById(id);
                if (element) {
                  element.textContent = value;
                  if (isInfo) {
                    element.classList.add('meta-info');
                  } else {
                    element.classList.remove('meta-info');
                  }
                }
              } catch (error) {
                console.error(`Error updating meta ${id}:`, error);
              }
            };
            
            try {
              updateElement('totalWork', secToHms(totalWork));
              
              if (isPresentDay) {
                updateMeta('workHuman', lastType === "in" ? "Currently Punched IN" : "Currently Punched OUT");
              } else {
                updateMeta('workHuman', lastType === "in" ? "Last status: Punched IN" : "Last status: Punched OUT");
              }
              
              updateElement('totalBreak', secToHms(totalBreak));
              updateMeta('breakHuman', `Break so far: ${secToHms(totalBreak)}`);
              
              const eightHoursInSec = 28800;
              const extraWorkSec = Math.max(0, totalWork - eightHoursInSec);
              updateElement('extraWork', secToHms(extraWorkSec));
              
              if (extraWorkSec > 0) {
                updateMeta('extraWorkMeta', `${secToHms(extraWorkSec)} beyond 8 hours`, true);
              } else {
                updateMeta('extraWorkMeta', 'Time worked beyond 8 hours');
              }
              
              for (const t of targets) {
                const left = Math.max(0, t.secs - totalWork);
                const suffix = t.label === "6.5" ? "65" : "80";
                
                const isCompleted = totalWork >= t.secs;
                
                if (isCompleted) {
                  updateElement(`left${suffix}`, secToHms(0));
                  updateElement(`logout${suffix}_no`, "Completed", true);
                } else {
                  updateElement(`left${suffix}`, secToHms(left));
                  
                  if (isPresentDay) {
                    const logoutTime = secToTimeStringFromNowAdd(left);
                    updateElement(`logout${suffix}_no`, logoutTime);
                  } else {
                    updateElement(`logout${suffix}_no`, "N/A (Past Day)");
                  }
                }
                
                if (breakExcess > 0) {
                  updateMeta(`logout${suffix}NoMeta`, `Includes ${secToHms(breakExcess)} compensation`, true);
                } else {
                  updateMeta(`logout${suffix}NoMeta`, '', false);
                }
              }
              
              if (breakExcess > 0) {
                updateElement('breakRemaining', "+" + secToHms(breakExcess));
                updateMeta('breakNote', `Exceeded by ${secToHms(breakExcess)}`, true);
              } else {
                updateElement('breakRemaining', secToHms(breakRemaining));
                updateMeta('breakNote', `Remaining ${secToHms(breakRemaining)}`);
              }
              
              let successMessage = `Processed ${punches.length} punch${punches.length !== 1 ? 'es' : ''} successfully`;
              if (handleDoublePunches) {
                successMessage += ' (Double punch correction applied)';
              }
              if (!isPresentDay) {
                successMessage += ' (Past Day mode)';
              }
              if (totalExplicitBreaks > 0) {
                successMessage += ` with ${secToHms(totalExplicitBreaks)} explicit breaks`;
              }
              showNotification(successMessage, 'success');
              
            } catch (error) {
              console.error('Error updating display elements:', error);
              showNotification('Error updating display', 'error');
            }
            
          } catch (error) {
            console.error('Processing error:', error);
            showNotification('Processing failed: ' + error.message, 'error');
          } finally {
            const btn = document.querySelector('#processBtn');
            btn.innerHTML = '⚡ Process Punches';
            btn.disabled = false;
            btn.classList.remove('loading');
            isProcessing = false;
          }
        }, 500);
        
      } catch (error) {
        console.error('Critical processing error:', error);
        showNotification('Critical error occurred', 'error');
        
        const btn = document.querySelector('#processBtn');
        if (btn) {
          btn.innerHTML = '⚡ Process Punches';
          btn.disabled = false;
          btn.classList.remove('loading');
        }
        isProcessing = false;
      }
    }

    // UPDATED Custom processing function
    function processCustom() {
      if (isProcessing) {
        showNotification('Processing already in progress', 'info');
        return;
      }
      
      try {
        isProcessing = true;
        
        const btn = document.querySelector('#customProcessBtn');
        const originalText = btn.innerHTML;
        btn.innerHTML = '⏳ Processing...';
        btn.disabled = true;
        btn.classList.add('loading');
        
        setTimeout(() => {
          try {
            const txt = document.getElementById('customAutoInput').value;
            
            // Enhanced validation
            const validation = validateLogFormat(txt);
            if (!validation.isValid) {
              showErrorIndication('customErrorIndication', true);
              showNotification('Invalid log format detected! ' + validation.error, 'error');
              return;
            } else {
              showErrorIndication('customErrorIndication', false);
            }
            
            // Get custom target hours
            const customHours = parseInt(document.getElementById('customHours').value) || 8;
            const customMinutes = parseInt(document.getElementById('customMinutes').value) || 0;
            const customTargetSec = (customHours * 3600) + (customMinutes * 60);
            
            if (customTargetSec <= 0) {
              showNotification('Please set a valid target time', 'error');
              return;
            }
            
            const handleDoublePunches = document.getElementById('customDoublePunchCheckbox').checked;
            // Custom view always works in present day mode (no radio buttons)
            const isPresentDay = true;
            
            const result = parsePunches(txt, handleDoublePunches);
            const { punches, errors, totalExplicitBreaks } = result;
            const logEl = document.getElementById('customLogEntries');
            
            if (!logEl) {
              throw new Error('Log element not found - DOM may be corrupted');
            }
            
            logEl.innerHTML = '';
            
            if (errors.length > 0) {
              console.warn('Parsing errors:', errors);
            }
            
            if (punches.length === 0) {
              logEl.innerHTML = `
                <div class="entry" style="justify-content:center; color:#ef4444;">
                  ${errors.length > 0 ? `Parsing errors found. Please check input format.` : 'No valid punches found'}
                </div>`;
              
              if (errors.length > 0) {
                showNotification(`Found ${errors.length} parsing error(s)`, 'error');
              }
            } else {
              punches.slice().reverse().forEach((p, index) => {
                try {
                  const div = document.createElement('div');
                  div.className = "entry";
                  div.innerHTML = `<span>${p.display}</span><span>${p.action}</span>`;
                  div.setAttribute('title', `${p.action} at ${p.display} (Line ${p.lineNumber || 'Unknown'})`);
                  div.style.animationDelay = `${index * 0.05}s`;
                  logEl.appendChild(div);
                } catch (error) {
                  console.error('Error creating log entry:', error);
                }
              });
            }
            
            let totalWork = 0, totalBreak = totalExplicitBreaks;
            let lastType = null, lastTime = null;
            
            try {
              for (const p of punches) {
                if (lastType === "in" && p.action === "Punch Out") {
                  const workTime = p.timeSec - lastTime;
                  if (workTime > 0 && workTime < 86400) {
                    totalWork += workTime;
                  }
                }
                if (lastType === "out" && p.action === "Punch In") {
                  const breakTime = p.timeSec - lastTime;
                  if (breakTime > 0 && breakTime < 86400) {
                    // Only add implicit break if no explicit breaks were found
                    if (totalExplicitBreaks === 0) {
                      totalBreak += breakTime;
                    }
                  }
                }
                if (p.action === "Punch In") {
                  lastType = "in";
                  lastTime = p.timeSec;
                }
                if (p.action === "Punch Out") {
                  lastType = "out";
                  lastTime = p.timeSec;
                }
              }
              
              if (isPresentDay && lastType === "in" && lastTime !== null) {
                try {
                  const now = new Date();
                  const nowSec = now.getHours() * 3600 + now.getMinutes() * 60 + now.getSeconds();
                  const currentWork = nowSec - lastTime;
                  if (currentWork > 0 && currentWork < 86400) {
                    totalWork += currentWork;
                  }
                } catch (error) {
                  console.error('Error calculating current work time:', error);
                }
              }
            } catch (error) {
              console.error('Error calculating work/break times:', error);
              showNotification('Error calculating times', 'error');
            }
            
            const allowedBreak = 3600;
            const breakExcess = Math.max(0, totalBreak - allowedBreak);
            
            // Apply break compensation to custom target
            const adjustedTargetSec = customTargetSec + breakExcess;
            
            const updateElement = (id, value, isCompleted = false) => {
              try {
                const element = document.getElementById(id);
                if (element) {
                  element.textContent = value;
                  element.classList.remove('error-state', 'completed');
                  if (isCompleted) {
                    element.classList.add('completed');
                  } else {
                    element.classList.add('success-state');
                    setTimeout(() => element.classList.remove('success-state'), 2000);
                  }
                } else {
                  console.warn(`Element with id '${id}' not found`);
                }
              } catch (error) {
                console.error(`Error updating element ${id}:`, error);
              }
            };

            const updateMeta = (id, value, isInfo = false) => {
              try {
                const element = document.getElementById(id);
                if (element) {
                  element.textContent = value;
                  if (isInfo) {
                    element.classList.add('meta-info');
                  } else {
                    element.classList.remove('meta-info');
                  }
                }
              } catch (error) {
                console.error(`Error updating meta ${id}:`, error);
              }
            };
            
            try {
              updateElement('customTotalWork', secToHms(totalWork));
              
              updateMeta('customWorkHuman', lastType === "in" ? "Currently Punched IN" : "Currently Punched OUT");
              
              updateElement('customTotalBreak', secToHms(totalBreak));
              updateMeta('customBreakHuman', `Break so far: ${secToHms(totalBreak)}`);
              
              // Custom target calculations
              const left = Math.max(0, adjustedTargetSec - totalWork);
              const isCompleted = totalWork >= adjustedTargetSec;
              
              if (isCompleted) {
                updateElement('customTimeLeft', secToHms(0));
                updateElement('customLogout', "Completed", true);
              } else {
                updateElement('customTimeLeft', secToHms(left));
                
                const logoutTime = secToTimeStringFromNowAdd(left);
                updateElement('customLogout', logoutTime);
              }
              
              if (breakExcess > 0) {
                updateMeta('customLogoutMeta', `Includes ${secToHms(breakExcess)} compensation`, true);
              } else {
                updateMeta('customLogoutMeta', '', false);
              }
              
              let successMessage = `Custom target (${secToHms(customTargetSec)}) processed with ${punches.length} punch${punches.length !== 1 ? 'es' : ''}`;
              if (handleDoublePunches) {
                successMessage += ' (Double punch correction applied)';
              }
              if (totalExplicitBreaks > 0) {
                successMessage += ` with ${secToHms(totalExplicitBreaks)} explicit breaks`;
              }
              showNotification(successMessage, 'success');
              
            } catch (error) {
              console.error('Error updating display elements:', error);
              showNotification('Error updating display', 'error');
            }
            
          } catch (error) {
            console.error('Processing error:', error);
            showNotification('Processing failed: ' + error.message, 'error');
          } finally {
            const btn = document.querySelector('#customProcessBtn');
            btn.innerHTML = '⚡ Process Punches';
            btn.disabled = false;
            btn.classList.remove('loading');
            isProcessing = false;
          }
        }, 500);
        
      } catch (error) {
        console.error('Critical processing error:', error);
        showNotification('Critical error occurred', 'error');
        
        const btn = document.querySelector('#customProcessBtn');
        if (btn) {
          btn.innerHTML = '⚡ Process Punches';
          btn.disabled = false;
          btn.classList.remove('loading');
        }
        isProcessing = false;
      }
    }

    // UPDATED: NEW Weekly processing function with Full Day/Half Day logic
    function processWeekly() {
      if (isProcessing) {
        showNotification('Processing already in progress', 'info');
        return;
      }
      
      try {
        isProcessing = true;
        
        const btn = document.querySelector('#weeklyProcessBtn');
        const originalText = btn.innerHTML;
        btn.innerHTML = '⏳ Processing...';
        btn.disabled = true;
        btn.classList.add('loading');
        
        setTimeout(() => {
          try {
            const txt = document.getElementById('weeklyPunchLogs').value;
            
            // Enhanced validation
            const validation = validateLogFormat(txt);
            if (!validation.isValid) {
              showErrorIndication('weeklyErrorIndication', true);
              showNotification('Invalid log format detected! ' + validation.error, 'error');
              return;
            } else {
              showErrorIndication('weeklyErrorIndication', false);
            }
            
            const workingDays = parseInt(document.getElementById('workingDays').value);
            
            // Validate working days
            if (workingDays > MAX_WORKING_DAYS) {
              showNotification(`Working days cannot exceed ${MAX_WORKING_DAYS}`, 'error');
              return;
            }
            
            let weeklyTarget = 0;
            let completedHours = 0;
            let halfDayCount = 0;
            
            // UPDATED: Calculate previous days with Full Day/Half Day logic
            for (let i = 1; i < workingDays; i++) {
              const statusInputs = document.querySelectorAll(`input[name="day${i}-status"]:checked`);
              if (statusInputs.length > 0) {
                const status = statusInputs[0].value;
                const hours = parseInt(document.getElementById(`day${i}-hours`).value) || 0;
                const minutes = parseInt(document.getElementById(`day${i}-minutes`).value) || 0;
                const dayHours = hours + (minutes / 60);
                
                if (status === 'full') {
                  weeklyTarget += WEEKLY_TARGET_PER_DAY; // 8 hours
                  completedHours += dayHours;
                } else if (status === 'half') {
                  weeklyTarget += HALF_DAY_HOURS; // 4 hours
                  completedHours += dayHours;
                  halfDayCount++;
                }
              }
            }
            
            // Add current day to weekly target (assume it's a full day)
            weeklyTarget += WEEKLY_TARGET_PER_DAY; // 8 hours for current day
            
            const handleDoublePunches = document.getElementById('weeklyDoublePunchCheckbox').checked;
            
            // Calculate current day work
            const { totalWork, totalBreak, punches } = calculateCurrentDayWork(txt, handleDoublePunches);
            const currentDayHours = totalWork / 3600;
            completedHours += currentDayHours;
            
            // Process punches for display
            const logEl = document.getElementById('weeklyLogEntries');
            if (!logEl) {
              throw new Error('Log element not found - DOM may be corrupted');
            }
            
            logEl.innerHTML = '';
            
            if (punches.length === 0) {
              logEl.innerHTML = '<div class="entry" style="justify-content:center; color:#ef4444;">No valid punches found</div>';
            } else {
              punches.slice().reverse().forEach((p, index) => {
                try {
                  const div = document.createElement('div');
                  div.className = "entry";
                  div.innerHTML = `<span>${p.display}</span><span>${p.action}</span>`;
                  div.setAttribute('title', `${p.action} at ${p.display} (Line ${p.lineNumber || 'Unknown'})`);
                  div.style.animationDelay = `${index * 0.05}s`;
                  logEl.appendChild(div);
                } catch (error) {
                  console.error('Error creating log entry:', error);
                }
              });
            }
            
            // Break compensation
            const allowedBreakSec = ALLOWED_BREAK_PER_DAY * 3600;
            const breakExcess = Math.max(0, totalBreak - allowedBreakSec);
            const breakCompensationHours = breakExcess / 3600;
            
            // Remaining hours needed
            const remainingHours = Math.max(0, weeklyTarget - completedHours);
            
            // UPDATED: Calculate logout requirements with proper daily minimum
            const currentDayMinimum = DAILY_MINIMUM_FULL; // Always 6.5 for current day (assuming full day)
            const dailyMinimumNeeded = Math.max(0, (currentDayMinimum * 3600) - totalWork + breakExcess);
            const weeklyNeeded = Math.max(0, (remainingHours * 3600) + breakExcess);
            const finalNeeded = Math.max(dailyMinimumNeeded, weeklyNeeded);
            const todayRequirementHours = Math.max(currentDayMinimum, remainingHours);
            
            const updateElement = (id, value, isCompleted = false) => {
              try {
                const element = document.getElementById(id);
                if (element) {
                  element.textContent = value;
                  element.classList.remove('error-state', 'completed');
                  if (isCompleted) {
                    element.classList.add('completed');
                  } else {
                    element.classList.add('success-state');
                    setTimeout(() => element.classList.remove('success-state'), 2000);
                  }
                }
              } catch (error) {
                console.error(`Error updating element ${id}:`, error);
              }
            };

            const updateMeta = (id, value, isInfo = false) => {
              try {
                const element = document.getElementById(id);
                if (element) {
                  element.textContent = value;
                  if (isInfo) {
                    element.classList.add('meta-info');
                  } else {
                    element.classList.remove('meta-info');
                  }
                }
              } catch (error) {
                console.error(`Error updating meta ${id}:`, error);
              }
            };
            
            // UPDATED: Display in HH:MM:SS format
            updateElement('weeklyTarget', secToHms(weeklyTarget * 3600));
            updateElement('weeklyCompleted', secToHms(completedHours * 3600));
            updateElement('weeklyCurrentWork', secToHms(totalWork));
            updateElement('weeklyBreakTaken', secToHms(totalBreak));
            updateElement('weeklyTodayReq', secToHms(todayRequirementHours * 3600));
            
            // Update meta information
            updateMeta('weeklyTargetMeta', `${workingDays} working days${halfDayCount > 0 ? ` (${halfDayCount} half day${halfDayCount > 1 ? 's' : ''})` : ''}`);
                       updateMeta('weeklyCompletedMeta', `${((completedHours - currentDayHours).toFixed(1))}h previous + ${currentDayHours.toFixed(1)}h current`);
            updateMeta('weeklyCurrentWorkMeta', punches.length > 0 ? `From ${punches.length} punch entries` : 'No punches processed');
            updateMeta('weeklyBreakTakenMeta', breakCompensationHours > 0.1 ? `+${breakCompensationHours.toFixed(1)}h compensation needed` : 'Within allowed limits', breakCompensationHours > 0.1);
            updateMeta('weeklyTodayReqMeta', `Daily min: ${currentDayMinimum}h vs Weekly need: ${remainingHours.toFixed(1)}h`);
            
            // Logout time
            if (finalNeeded > 0) {
              const logoutTime = secToTimeStringFromNowAdd(finalNeeded);
              updateElement('weeklyRecommendedLogout', logoutTime);
              updateMeta('weeklyLogoutMeta', breakCompensationHours > 0.1 ? `Includes ${breakCompensationHours.toFixed(1)}h break compensation` : 'No break compensation needed', breakCompensationHours > 0.1);
            } else {
              updateElement('weeklyRecommendedLogout', 'Completed', true);
              updateMeta('weeklyLogoutMeta', 'Weekly target achieved!', true);
            }
            
            // Generate weekly alerts
            generateWeeklyAlerts(finalNeeded, remainingHours, currentDayHours, breakCompensationHours, weeklyTarget, completedHours);
            
            let successMessage = `Weekly tracking processed: ${punches.length} punch${punches.length !== 1 ? 'es' : ''} with ${workingDays} working days`;
            if (halfDayCount > 0) {
              successMessage += ` (${halfDayCount} half day${halfDayCount > 1 ? 's' : ''})`;
            }
            if (handleDoublePunches) {
              successMessage += ' (Double punch correction applied)';
            }
            showNotification(successMessage, 'success');
            
          } catch (error) {
            console.error('Processing error:', error);
            showNotification('Processing failed: ' + error.message, 'error');
          } finally {
            const btn = document.querySelector('#weeklyProcessBtn');
            btn.innerHTML = '⚡ Process Weekly Requirements';
            btn.disabled = false;
            btn.classList.remove('loading');
            isProcessing = false;
          }
        }, 500);
        
      } catch (error) {
        console.error('Critical processing error:', error);
        showNotification('Critical error occurred', 'error');
        
        const btn = document.querySelector('#weeklyProcessBtn');
        if (btn) {
          btn.innerHTML = '⚡ Process Weekly Requirements';
          btn.disabled = false;
          btn.classList.remove('loading');
        }
        isProcessing = false;
      }
    }

    // UPDATED: Generate weekly alerts
    function generateWeeklyAlerts(finalNeededSec, remainingHours, currentDayHours, breakCompensation, weeklyTarget, completedHours) {
      const alertContainer = document.getElementById('weeklyAlertContainer');
      alertContainer.innerHTML = '';

      let alertMessage = '';
      let alertClass = '';
      
      const finalNeededHours = finalNeededSec / 3600;
      const progress = (completedHours / weeklyTarget) * 100;

      if (finalNeededSec <= 0) {
        alertMessage = '🎉 Excellent! You have completed your weekly target and daily minimum requirements.';
        alertClass = 'success';
      } else if (finalNeededHours <= 1) {
        alertMessage = `✅ Almost done! Only ${finalNeededHours.toFixed(1)} more hours needed today to meet weekly target.`;
        alertClass = 'success';
      } else if (finalNeededHours <= 3) {
        alertMessage = `💼 Good progress! ${finalNeededHours.toFixed(1)} hours remaining for today. You're ${progress.toFixed(0)}% complete this week.`;
        alertClass = 'success';
      } else if (finalNeededHours <= 6.5) {
        alertMessage = `⏰ Standard workload: ${finalNeededHours.toFixed(1)} hours needed to meet weekly target. Currently at ${progress.toFixed(0)}% completion.`;
        alertClass = 'warning';
      } else {
        alertMessage = `⚠️ Heavy workload: ${finalNeededHours.toFixed(1)} hours required today to meet weekly target. Consider planning ahead for future weeks.`;
        alertClass = 'danger';
      }

      if (breakCompensation > 0.1) {
        alertMessage += ` Note: ${breakCompensation.toFixed(1)} hours added for excess break compensation.`;
      }

      if (remainingHours < 0) {
        alertMessage += ` You have ${Math.abs(remainingHours).toFixed(1)} hours of credit this week!`;
        alertClass = 'success';
      }

      const alertDiv = document.createElement('div');
      alertDiv.className = `weekly-alert ${alertClass}`;
      alertDiv.textContent = alertMessage;
      alertContainer.appendChild(alertDiv);
    }

    // Enhanced security measures with red gradient notifications
    document.addEventListener("contextmenu", e => {
      e.preventDefault();
      showNotification("Right Click is disabled", 'error');
    });

    document.addEventListener("keydown", function(e) {
      try {
        if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'u') {
          e.preventDefault();
          showNotification("View Source is disabled", 'error');
        }
        if (e.key === "F12") {
          e.preventDefault();
          showNotification("Inspect is disabled", 'error');
        }
        if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'I') {
          e.preventDefault();
          showNotification("Developer Tools disabled", 'error');
        }
      } catch (error) {
        console.error('Keydown handler error:', error);
      }
    });

    // Event listeners for weekly view
    document.addEventListener('input', function(e) {
      if (currentView === 'weekly' && (e.target.id === 'weeklyPunchLogs' || e.target.classList.contains('time-input'))) {
        // Auto-calculate could be added here if needed
      }
    });

    document.addEventListener('change', function(e) {
      if (currentView === 'weekly' && e.target.type === 'radio' && e.target.name.includes('day')) {
        // Auto-calculate could be added here if needed
      }
    });

    window.addEventListener('load', () => {
      console.log('Punch Tracker loaded successfully');
      showNotification('Punch Tracker loaded successfully', 'success');
      
      // Initialize weekly view
      generateDayRows();
      
      setTimeout(() => {
        showWelcomeModal();
      }, 1000);
    });

    window.addEventListener('beforeunload', () => {
      try {
        if (clockInterval) {
          clearInterval(clockInterval);
          clockInterval = null;
        }
        isProcessing = false;
      } catch (error) {
        console.error('Cleanup error:', error);
      }
    });

  </script>
</body>
</html>
